---
title: "Paper_stuff"
output: html_document
date: "2023-09-12"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Libraries
library(tidyverse)
library(dplyr)
library(haven)
library(ggplot2)
library(tidyr)
```

# Import data

Read in the dataset. 
```{r}
Mothership <- read_sav("~/Desktop/Coding/data/PHPoutcome_clean.sav")
View(df)
```

## Rename and Recode variables 
We can change the current variables to make them easier to interpret. 
```{r}
#recode varaibles
Mothership <- mutate(Mothership, 
                     Education_1 = as.factor(Education_1),
                     Education_1 = recode(Education_1,
                          "0"="<Grade 12",
                          "1"="<Grade 12",
                          "2"="HS Diploma or GED",
                          "3"="HS Diploma or GED",
                          "4"="Some College/Associates Degree",
                          "5"="Some College/Associates Degree",
                          "6"="Bachelors Degree",
                          "7"="Bachelors Degree",
                          "8"="Grad Degree"),
                     Gender_1 = as.factor(Gender_1),
                     Gender_1 = recode(Gender_1,
                          "0"="Female",
                          "1"="Male",
                          "2"="Non-Binary",
                          "3"="Other",
                          "4"="Other"),
                     Relationship_1 = ifelse(Relationship_1 == 8, NA, Relationship_1),
                     Relationship_1 = as.factor(Relationship_1),
                     Relationship_1 = recode(Relationship_1,
                          "0"="Married or Cohabitating",
                          "1"="Married or Cohabitating",
                          "2"="Widowed or Separated",
                          "3"="Widowed or Separated",
                          "4"="Divorced",
                          "5"="Single or Never Married"),
                     Sexuality_1 = as.factor(Sexuality_1),
                     Sexuality_1 = recode(Sexuality_1,
                          "1"="Straight",
                          "2"="Gay",
                          "3"="Bisexual",
                          "4"="Other"),
                     IPT_track_1 = as.factor(IPT_track_1),
                     IPT_track_1 = recode(IPT_track_1,
                          "0"="General",
                          "1"="Trauma",
                          "2"="Young Adult",
                          "3"="BPD"),
                     Race_1 = ifelse(Race_1 == 6, NA, Race_1),
                     Race_1 = as.factor(Race_1),
                     Race_1 = recode(Race_1,
                                     "0"="White",
                                     "1"="Black",
                                     "2"="Hispanic",
                                     "3"="Asian",
                                     "4"="Portugese",
                                     "5"="Other"),
                    DC_status_1 = as.factor(DC_status_1),
                    DC_status_1 = recode(DC_status_1,
                                      "1" ="Inpatient",
                                      "2" ="PHP",
                                      "3" ="APS",
                                      "4" ="Psychatrist",
                                      "5" ="PCP",
                                      "6" ="Another Physican",
                                      "7" ="Therapist",
                                      "8"="Withdrew (AMA)",
                                      "9"="Other",
                                      "10"="Other",
                                      "11"="Other",
                                      "17"="Other",
                                      "0" ="Other"),
                                        
#Lets make some new variables 
      #Duration of treatment
                     Duration = as.factor(
                       ifelse(Days_complete_1>0 & Days_complete_1 <=5, "1",
                       ifelse(Days_complete_1>5 & Days_complete_1 <=10, "2",
                       ifelse(Days_complete_1>10 & Days_complete_1 <=15, "3",
                       ifelse(is.na(Days_complete_1), NA, "4"
                              ))))),
                    Duration_lab = as.factor(recode(Duration,
                                      "1"="1-5",
                                      "2"="6-10",
                                      "3"="11-15",
                                      "4"="16+"
                                      )),
                    Duration_10 = as.factor(
                      ifelse(Duration == 1 | Duration == 2, "1",
                      ifelse(Duration == 3 | Duration == 4, "2", NA)
                      )))

#Extract Year From Intake Date
#Convert to Date
library("lubridate")
Mothership$Intake_1<-ymd(Mothership$Intake_1)
Mothership$TxYear<-as.numeric(format(Mothership$Intake_1,"%Y"))
Mothership<-mutate(Mothership,
                   TxYear = as.factor(TxYear),
                   TxYear = recode(TxYear,
                                   "1582"="2014"))

```


## Export as CSV
```{r}
write.csv(Mothership,"~/Desktop/Coding/data/Mothership_paper")
```

Disorder_varaibles
```{r}
Mothership<-Mothership %>%
  mutate(
          # Mood Disorders
                     Mood_D = as.factor(
                      ifelse(
                        MDD_P ==1 | Bipolar1_P == 1 | Bipolar2_P == 1 | Dysthymia_P == 1, 1, 0)),
          # Anxiety Disorders
                    Anxiety_D = as.factor(
                      ifelse(
                        GAD_P ==1 | Panic_P == 1 | PanicAgor_P == 1 | Agoraphobia_P == 1 |
                        Social_P == 1 | Specific_P == 1, 1, 0)),
          # Obsessive Compusive Disorders
                #OCD_P is for current OCD
                OCD_P = as.factor(OCD_P),
          # Personality Disorders
                #BPD_P is for current BPD
                BPD_P = as.factor(BPD_P),
          # Substance Use Disorders
                    Substance_D = as.factor(
                      ifelse(
                        Alcohol_P == 1 | Drug_P ==1, 1, 0)),
          # Trauma or stresor related disorders
                    Trauma_D = as.factor(
                      ifelse(PTSD_P == 1 | Adjustment_P ==1, 1,0)),
          # Psychotic Disorders
                    Psychotic_D = as.factor(
                      ifelse(
                        Schiz_P == 1 | Schizaff_P == 1,1,0)),
            # Eating Disorders
                    Eating_D = as.factor(
                      ifelse(
                        Anorex_P == 1 | Bulim_P == 1 | Binge_P == 1, 1,0)),
            # Somatic Disroders
                    Somatic_D = as.factor(
                      ifelse(
                        Somat_P == 1 | UndiffSoma_P == 1| Hypochondriasis_P ==1,
                        1,0)),
                    Other = as.factor(
                        ifelse(
                        Somat_P == 1 | UndiffSoma_P == 1| Hypochondriasis_P ==1 |
                        Anorex_P == 1 | Bulim_P == 1 | Binge_P == 1 | Schiz_P == 1 | 
                        Schizaff_P == 1 | Alcohol_P == 1 | Drug_P ==1 | OCD_P ==1,
                        1,0)),
                    Disorder_Type = as.factor(
                      ifelse(Anxiety_D == 1, "Anxiety",
                      ifelse(OCD_P == 1, "OCD",
                      ifelse(BPD_P == 1, "BPD",
                      ifelse(Substance_D == 1, "Substance Use",
                      ifelse(Trauma_D == 1, "Trauma",
                      ifelse(Mood_D == 1, "Mood",
                      ifelse(Psychotic_D == 1, "Psychotic", 
                      ifelse(Eating_D == 1, "Eating", 
                      ifelse(Somatic_D == 1, "Somatic", NA
                      )))))))))),
                    Disorder_treat = as.factor(
                      ifelse(Anxiety_D == 1, "Anxiety",
                      ifelse(BPD_P == 1, "BPD",
                      ifelse(Trauma_D == 1, "Trauma",
                      ifelse(Mood_D == 1, "Mood",
                      ifelse(OCD_P == 1, "Other",
                      ifelse(Substance_D == 1, "Other",
                      ifelse(Psychotic_D == 1, "Other", 
                      ifelse(Eating_D == 1, "Other", NA
                      ))))))))),
                  Anxiety_C =  as.factor(
                    ifelse( GAD_P !=1 & GAD_C ==1 | 
                        Panic_P != 1 & Panic_C == 1 | 
                        PanicAgor_P != 1 & PanicAgor_C == 1 | 
                        Agoraphobia_P != 1 & Agoraphobia_C == 1 |
                        Social_P != 1 & Social_C == 1 | 
                        Specific_P != 1 & Specific_C == 1, 1, 0)),
                  Mood_C =  as.factor(
                    ifelse( MDD_P != 1 & MDD_C == 1 |
                        Bipolar1_P != 1 & Bipolar1_C == 1 | 
                        Bipolar2_P != 1 &  Bipolar2_C == 1 | 
                        Dysthymia_P != 1 & Dysthymia_C == 1 , 1, 0)),
                  Substance_C = as.factor(
                    ifelse(Alcohol_P != 1 & Alcohol_C == 1 | 
                        Drug_P != 1 & Drug_C ==1, 1, 0)),
                  Trauma_C = as.factor(
                    ifelse(PTSD_P != 1 & PTSD_C == 1 | 
                        Adjustment_P != 1 & Adjustment_C ==1, 1,0)),
                  Psychotic_C = as.factor(
                    ifelse(Schiz_P != 1 & Schiz_C == 1 | 
                        Schizaff_P != 1 & Schizaff_C == 1,1,0)),
                  Eating_C = as.factor(
                    ifelse(Anorex_P != 1 & Anorex_C == 1 | 
                        Bulim_P != 1 & Bulim_C == 1 | 
                        Binge_P != 1 & Binge_C == 1, 1,0)),
                  Somatic_C = as.factor(
                    ifelse(Somat_P != 1 & Somat_C == 1 | 
                        UndiffSoma_P != 1 & UndiffSoma_C == 1 | 
                        Hypochondriasis_P != 1 &  Hypochondriasis_C == 1, 1,0)),
                  OCD_Co_C = as.factor(
                    ifelse(OCD_P != 1 & OCD_C == 1,1,0)),
                  BPD_Co_C = as.factor(
                    ifelse(BPD_P != 1 & BPD_C ==1,1,0)),
                  No_Co = as.factor(
                    ifelse(BPD_Co_C == 0 &
                           OCD_Co_C == 0 &
                           Somatic_C == 0 & 
                           Eating_C == 0 &
                           Psychotic_C == 0 &
                           Trauma_C == 0 & 
                           Substance_C == 0 &
                           Mood_C == 0 &
                           Anxiety_C == 0, 1,0)),
                  Other_Co = as.factor(
                    ifelse(OCD_Co_C == 1 & 
                           Somatic_C == 1 & 
                           Eating_C == 1 &
                           Psychotic_C == 1,1,0)),
                  
          #emotional disorders
                  Emotional_dis = as.factor(
                    ifelse(Anxiety_D == 1 | OCD_P == 1 | Trauma_D == 1 |
                           Mood_D == 1, "Emotional Disorder", "Other Disorder")),
                 
          # co occuring disorders
                  Co_Anx = as.factor(
                        ifelse(Anxiety_C == 1 & Mood_D == 1 |
                                Anxiety_C == 1 & OCD_P == 1 |
                                Anxiety_C == 1 & BPD_P == 1 |
                                Anxiety_C == 1 & Substance_D == 1 |
                                Anxiety_C == 1 & Trauma_D == 1 |
                                Anxiety_C == 1 & Eating_D ==1 |
                                Anxiety_C == 1 & Psychotic_D ==1 |
                                Anxiety_C == 1 & Somatic_D ==1, 1, 0)),
                  Co_Mood = as.factor(
                        ifelse(Mood_C == 1 & Anxiety_D == 1 |
                                Mood_C == 1 & OCD_P == 1 |
                                Mood_C == 1 & BPD_P == 1 |
                                Mood_C == 1 & Substance_D == 1 |
                                Mood_C == 1 & Trauma_D == 1 |
                                Mood_C == 1 & Eating_D ==1 |
                                Mood_C == 1 & Psychotic_D ==1 |
                                Mood_C == 1 & Somatic_D==1 , 1, 0)),
                  Co_OCD = as.factor(
                        ifelse(OCD_C == 1 & Anxiety_D == 1 |
                                OCD_C == 1 & Mood_D == 1 |
                                OCD_C == 1 & BPD_P== 1 |
                                OCD_C == 1 & Substance_D == 1 |
                                OCD_C == 1 & Trauma_D == 1 |
                                OCD_C == 1 & Eating_D ==1 |
                                OCD_C == 1 & Psychotic_D ==1 |
                                OCD_C == 1 & Somatic_D ==1, 1, 0)),
                  Co_BPD = as.factor(
                        ifelse(BPD_C == 1 & Anxiety_D == 1 |
                                BPD_C == 1 & Mood_D == 1 |
                                BPD_C == 1 & OCD_P== 1 |
                                BPD_C == 1 & Substance_D == 1 |
                                BPD_C == 1 & Trauma_D == 1 |
                                BPD_C == 1 & Eating_D ==1 |
                                BPD_C == 1 & Psychotic_D ==1 |
                                BPD_C == 1 & Somatic_D ==1 , 1, 0)),
                  Co_Psychotic = as.factor(
                       ifelse(Psychotic_C == 1 & Mood_D == 1 |
                                Psychotic_C == 1 & OCD_P == 1 |
                                Psychotic_C == 1 & BPD_P == 1 |
                                Psychotic_C == 1 & Substance_D == 1 |
                                Psychotic_C == 1 & Trauma_D == 1 |
                                Psychotic_C == 1 & Eating_D ==1 |
                                Psychotic_C == 1 & Anxiety_D ==1 |
                                Psychotic_C == 1 & Somatic_D ==1, 1, 0)),
                  Co_Eating = as.factor(
                      ifelse(Eating_C == 1 & Mood_D == 1 |
                                Eating_C == 1 & OCD_P == 1 |
                                Eating_C == 1 & BPD_P == 1 |
                                Eating_C == 1 & Substance_D == 1 |
                                Eating_C == 1 & Trauma_D == 1 |
                                Eating_C == 1 & Psychotic_D ==1 |
                                Eating_C == 1 & Anxiety_D ==1 |
                                Eating_C == 1 & Somatic_D ==1, 1, 0)),
                  Co_Somatic =  as.factor(
                       ifelse(Somatic_C == 1 & Mood_D == 1 |
                                Somatic_C == 1 & OCD_P == 1 |
                                Somatic_C == 1 & BPD_P == 1 |
                                Somatic_C == 1 & Substance_D == 1 |
                                Somatic_C == 1 & Trauma_D == 1 |
                                Somatic_C == 1 & Eating_D ==1 |
                                Somatic_C == 1 & Anxiety_D ==1 |
                                Somatic_C == 1 & Substance_D ==1 |
                                Somatic_C == 1 & Psychotic_D ==1, 1, 0)),
                  Co_Substance = as.factor(
                      ifelse(Substance_C == 1 & Mood_D == 1 |
                                Substance_C == 1 & OCD_P == 1 |
                                Substance_C == 1 & BPD_P == 1 |
                                Substance_C == 1 & Substance_D == 1 |
                                Substance_C == 1 & Trauma_D == 1 |
                                Substance_C == 1 & Eating_D ==1 |
                                Substance_C == 1 & Anxiety_D ==1 |
                                Substance_C == 1 & Somatic_D ==1 |
                                Substance_C == 1 & Psychotic_D ==1, 1, 0)),
                 Co_Trauma = as.factor(
                    ifelse(Trauma_C == 1 & Mood_D == 1 |
                                Trauma_C == 1 & OCD_P == 1 |
                                Trauma_C == 1 & BPD_P == 1 |
                                Trauma_C == 1 & Substance_D == 1 |
                                Trauma_C == 1 & Eating_D ==1 |
                                Trauma_C == 1 & Anxiety_D ==1 |
                                Trauma_C == 1 & Somatic_D ==1 |
                                Trauma_C == 1 & Psychotic_D ==1, 1, 0))
  )
          
##### df for plots 

# only include people that attend treatment & its thier first time attending
Mothership <- Mothership |>
        filter(
          is.na(Prev_AdmitID_1),
          C_Admit_1 == 1
          ) |>
        mutate(
          dummy = -99
        )

# df without NAs in date and disorder type
Mothership_Diag <- Mothership |>
  filter(!is.na(Disorder_Type)) |>
  filter(!is.na(TxYear))

Mothership_Diag_treat <- Mothership |>
  filter(!is.na(Disorder_treat),
         !is.na(TxYear),
         !is.na(Duration)) 

### Export as CSV
write.csv(Mothership,"~/Desktop/Coding/data/Mothership_Diag.csv")

# df with and without depression
No_depressy <- Mothership_Diag %>%
  filter(Disorder_Type != "Mood")
```

Pre_Post
### Extract pre/post scores
```{r}
#1. load DF
    Mothership_post <- Mothership_Diag_treat

    # Depressiopn
    CUDOS_Score_post <-  select(Mothership_post, dummy,Day1_CUDOS:Day40_CUDOS)
    # Anxiety
    CUXOS_Score_post <- select(Mothership_post, dummy,Day1_CUXOS:Day40_CUXOS)

#2. Getting post scores for people who have NA for post
    
    # Depression
    Post_DEP <- NA
    PD_df <- NA
    for(i in 1:nrow(CUDOS_Score_post)){
    PD_df <- unname(unlist(CUDOS_Score_post[i,]))
    PD_df <- PD_df[!is.na(PD_df)]
    PD_df <- tail(PD_df, n=1)
    Post_DEP <- rbind(Post_DEP,PD_df)
    }
    Post_Dep <- Post_DEP[-1]

    # Anxiety
    Post_ANX <- NA
    PA_df <- NA
    for(i in 1:nrow(CUXOS_Score_post)){
    PA_df <- unname(unlist(CUXOS_Score_post[i,]))
    PA_df <- PA_df[!is.na(PA_df)]
    PA_df <- tail(PA_df, n=1)
    Post_ANX <- rbind(Post_ANX,PA_df)
    }
    Post_anx <- Post_ANX[-1]

# 3. Getting BL scores for people who have NA at Baseline 
  
    # Depression / Anxiety Dummy variable
    CUDOS_Score_pre <-  select(Mothership_post, Day1_CUDOS:Day40_CUDOS,dummy)
    CUXOS_Score_pre <- select(Mothership_post, Day1_CUXOS:Day40_CUXOS,dummy)

    # Depression
    Pre_DEP <- NA
    PD_df <- NA
    for(i in 1:nrow(CUDOS_Score_pre)){
    PD_df <- unname(unlist(CUDOS_Score_pre[i,]))
    PD_df <- PD_df[!is.na(PD_df)]
    PD_df <- head(PD_df, n=1)
    Pre_DEP <- rbind(Pre_DEP,PD_df)
    }
    Pre_dep <- Pre_DEP[-1]

    # Anxiety
    Pre_ANX <- NA
    PA_df <- NA
    for(i in 1:nrow(CUXOS_Score_pre)){
    PA_df <- unname(unlist(CUXOS_Score_pre[i,]))
    PA_df <- PA_df[!is.na(PA_df)]
    PA_df <- head(PA_df, n=1)
    Pre_ANX <- rbind(Pre_ANX,PA_df)
    }
    Pre_anx <- Pre_ANX[-1]
#4 Adding it back to mother ship
    Mothership_post <- Mothership_post |>
      mutate(
        CUDOS_first = ifelse(is.na(BL_CUDOS),Pre_dep,BL_CUDOS),
           CUDOS_first = ifelse(CUDOS_first < 0, NA, CUDOS_first),
        CUXOS_first = ifelse(is.na(BL_CUXOS),Pre_anx,BL_CUXOS),
           CUXOS_first = ifelse(CUXOS_first < 0, NA, CUXOS_first),
        CUDOS_pre = BL_CUDOS,
        CUXOS_pre = BL_CUXOS,
        CUDOS_post = ifelse(!is.na(SUMdep_DC), SUMdep_DC,Post_Dep),
            CUDOS_post = ifelse(CUDOS_post < 0, NA, CUDOS_post),
        CUXOS_post = ifelse(!is.na(SUManx_DC), SUManx_DC,Post_anx),
            CUXOS_post = ifelse(CUXOS_post < 0, NA, CUXOS_post),
        BL_Missing = as.factor(ifelse(is.na(BL_CUXOS), "Anx Missing",
                               ifelse(is.na(BL_CUDOS), "Dep Missing", "Not Missing"
                                      ))),
        Sig_BL = as.factor(ifelse(BL_CUXOS > 20 & BL_CUDOS > 20, "Sig Both",
                           ifelse(BL_CUXOS > 20, "Sig Anx",
                           ifelse(BL_CUDOS > 20, "Sig Dep",
                           ifelse(is.na(BL_CUXOS),NA,
                           ifelse(is.na(BL_CUDOS),NA, "Sub Both"
                        )))))),
        Sig_BL_Anx = as.factor(ifelse(BL_CUXOS > 20, "Significant",
                               ifelse(is.na(BL_CUXOS),NA, "Subclinical"
                              ))),
        Sig_BL_Dep = as.factor(ifelse(BL_CUDOS > 20, "Significant",
                               ifelse(is.na(BL_CUDOS),NA, "Subclinical"
                              ))),
        Sig_Post_Anx = as.factor(ifelse(CUXOS_post > 20, "Significant",
                               ifelse(is.na(CUXOS_post),NA, "Subclinical"
                              ))),
        Sig_Post_Dep = as.factor(ifelse(CUDOS_post > 20, "Significant",
                               ifelse(is.na(CUDOS_post),NA, "Subclinical"
                              ))),
        Any_Sig_BL = as.factor(ifelse(BL_CUXOS > 20 | BL_CUDOS > 20, "Sig",
                               ifelse(is.na(BL_CUXOS),NA,
                               ifelse(is.na(BL_CUDOS),NA, "Sub"
                               )))),
        Any_Sig_Post = as.factor(ifelse(CUXOS_post > 20 | CUDOS_post > 20, "Sig",
                               ifelse(is.na(CUXOS_post),NA,
                               ifelse(is.na(CUDOS_post),NA, "Sub"
                               )))),
        Sig_BL = as.factor(ifelse(BL_CUXOS > 20 & BL_CUDOS > 20, "Sig Both",
                 ifelse(BL_CUXOS > 20, "Sig Anx",
                 ifelse(BL_CUDOS > 20, "Sig Dep",
                 ifelse(is.na(BL_CUDOS), NA,
                 ifelse(is.na(BL_CUXOS), NA, "Subclinical"
                        )))))),
        Sig_Post = as.factor(ifelse(CUXOS_post > 20 & CUDOS_post > 20, "Sig Both",
                 ifelse(CUXOS_post > 20, "Sig Anx",
                 ifelse(CUDOS_post > 20, "Sig Dep",
                 ifelse(is.na(CUDOS_post), NA,
                 ifelse(is.na(CUXOS_post), NA, "Subclinical"
                        )))))),
        Sig_unresponse_type = as.factor(ifelse(Sig_BL %in% c("Sig Both","Sig Anx","Sig Dep") & Sig_Post == "Subclinical", "Responder",
                            ifelse(Sig_BL == "Sig Both" & Sig_Post == "Sig Both", "Non-responder",
                            ifelse(Sig_BL == "Sig Anx" & Sig_Post == "Sig Anx", "Non-responder",
                            ifelse(Sig_BL == "Sig Dep" & Sig_Post == "Sig Dep", "Non-responder",
                            ifelse(Sig_BL == "Sig Both" & Sig_Post == "Sig Anx", "Dep gone Anx not",
                            ifelse(Sig_BL == "Sig Both" & Sig_Post == "Sig Dep", "Anx gone Dep not", 
                            ifelse(ifelse(Sig_BL == "Subclinical" & Sig_Post == "Subclinical", "Low_BL",       
                                   NA
                            ))))))))),
        Sig_unresponse = as.factor(ifelse(Sig_BL %in% c("Sig Both","Sig Anx","Sig Dep") & Sig_Post == "Subclinical", "Responder",
                                        ifelse(Sig_BL %in% c("Sig Both","Sig Anx","Sig Dep") & Sig_Post %in% c("Sig Both","Sig Anx","Sig Dep"), "Non-responder",
                                        ifelse(ifelse(Sig_BL == "Subclinical" & Sig_Post == "Subclinical", "Low_BL",       
                                   NA
                                   ))))),
                            
              #deprssion values Symptom severity: 0-10 (remission), 11-20 (minimal), 21-30 (mild), 31-45 (moderate), 46+ (severe)"
        BL_Dep_level = as.factor(ifelse(BL_CUDOS > 10 & BL_CUDOS <= 20, "Minimal",
                                 ifelse(BL_CUDOS > 20 & BL_CUDOS <= 30, "Mild",
                                 ifelse(BL_CUDOS > 10 & BL_CUDOS <= 45, "Moderate",
                                 ifelse(BL_CUDOS > 45, "Severe",
                                 ifelse(is.na(BL_CUDOS), NA, "Remission"
                                )))))),
        BL_Anx_level = as.factor(ifelse(BL_CUXOS > 10 & BL_CUXOS <= 20, "Minimal",
                                 ifelse(BL_CUXOS > 20 & BL_CUXOS <= 30, "Mild",
                                 ifelse(BL_CUXOS > 10 & BL_CUXOS <= 45, "Moderate",
                                 ifelse(BL_CUXOS > 45, "Severe",
                                 ifelse(is.na(BL_CUXOS), NA, "Remission"
                                )))))),
        Post_Dep_level = as.factor(ifelse(CUDOS_post > 10 & CUDOS_post <= 20, "Minimal",
                                 ifelse(CUDOS_post > 20 & CUDOS_post <= 30, "Mild",
                                 ifelse(CUDOS_post > 10 & CUDOS_post <= 45, "Moderate",
                                 ifelse(CUDOS_post > 45, "Severe",
                                 ifelse(is.na(CUDOS_post), NA, "Remission"
                                )))))),
        Post_Anx_level = as.factor(ifelse(CUXOS_post > 10 & CUXOS_post <= 20, "Minimal",
                                 ifelse(CUXOS_post > 20 & CUXOS_post <= 30, "Mild",
                                 ifelse(CUXOS_post > 10 & CUXOS_post <= 45, "Moderate",
                                 ifelse(CUXOS_post > 45, "Severe",
                                 ifelse(is.na(CUXOS_post), NA, "Remission"
                                )))))))
    ```
   
Responders
```{r}
#devtools::install_github("AWKruijt/JT-RCI")

library(JTRCI)

#devtools::install_github("zieglema/ClinicalSig")
library(ClinicalSig)
# generate some random data:

RCI_df_dep <- Mothership_post |>
  mutate(
    ID1  = as.integer(ID1),
    pre  = as.numeric(CUDOS_pre),
    post = as.numeric(CUDOS_post),
    Disorder = Disorder_treat
  ) |>
  select(
    ID1,pre,post,Disorder
  ) |>
  filter(!is.na(pre),
         !is.na(post),
         pre > 20)

RCI_df_anx <- Mothership_post |>
  mutate(
    ID1  = as.integer(ID1),
    pre  = as.numeric(CUXOS_pre),
    post = as.numeric(CUXOS_post),
    Disorder = Disorder_treat
  ) |>
  select(
    ID1,pre,post,Disorder
  ) |>
  filter(!is.na(pre),
         !is.na(post),
         pre > 20)


RCI_df_dep <- data.frame(RCI_df_dep)
RCI_df_anx <- data.frame(RCI_df_anx)

# https://awkruijt.netlify.app/plotposts/longitudinaljtrci

RCI_df_anx1<-RCI_df_anx |>
  select(ID1,pre,post)

DEP_RCI <- JTRCI (data = RCI_df_dep, 
       pre = "pre", 
       post = "post", 
       ppid = "ID1", 
       reliability = .74, 
       indextype = "RCI", 
       #JTcrit = "auto",
       plottitle = "Anxeity: JT indices by disorder")

ANX_RCI <- JTRCI (data = RCI_df_anx, 
       pre = "pre", 
       post = "post", 
       ppid = "ID1", 
       reliability = .74, 
       indextype = "RCI", 
       #JTcrit = "auto",
       plottitle = "Anxeity: JT indices by disorder")

RCI_DF<- ANX_RCI$data
colnames(RCI_DF) <- paste0(colnames(RCI_DF),"_anx")

RCI_DF2<- DEP_RCI$data
colnames(RCI_DF2) <- paste0(colnames(RCI_DF2),"_dep")

RCI_DF <- full_join(RCI_DF,RCI_DF2, by = c("ppid_anx" = "ppid_dep"))
colnames(RCI_DF)[1] = "ID1"

RCI_DF
```

RCI
    ```{r}
Mothership_post <- Mothership_post |>
  #1. Filter out scores for people not in the program / don't have dataa
  filter(!is.na(Days_complete_1)) |>
    #Having people in the program for more than 40 days means that their scores may be a lot higher, they should be filtered out as result. 
  filter(!is.na(CUXOS_pre),
         !is.na(CUXOS_post),
         CUXOS_pre > 0,
         CUXOS_post >= 0,
         !is.na(CUDOS_pre),
         !is.na(CUDOS_post),
         CUDOS_pre > 0,
         CUDOS_post> 0
         ) |>
  mutate(
    Delta_Anx_DC =  CUXOS_post - CUXOS_pre,
    Delta_Dep_DC = CUDOS_post - CUDOS_pre,
    Percent_Anx_change = (Delta_Anx_DC/CUXOS_pre)*100,
    Percent_Dep_Dchange = (Delta_Dep_DC/CUDOS_pre)*100,
    #Days_complete_W = ifelse(Days_complete_1 > 40, 40, Days_complete_1),
    Anx_Responder = as.factor(
      ifelse(CUXOS_pre < 20 & Percent_Anx_change  <= -50, "Responder",
      ifelse(CUXOS_pre < 20 & Percent_Anx_change  > -50,  "Unresponders", NA)   
      )),
    Dep_Responder = as.factor(
      ifelse(CUDOS_pre < 20 & Percent_Dep_Dchange <= -50, "Responder",
      ifelse(CUDOS_pre < 20 & Percent_Dep_Dchange > -50,   "Unresponders", NA) 
      )),
    Treatment_Responder = as.factor(
      ifelse(CUXOS_pre > 10 & CUXOS_pre > 10 & Percent_Anx_change  <= -50 & Percent_Anx_change < 0 & Percent_Dep_Dchange < 0 & Percent_Dep_Dchange <= -50, "Both_Responder", 
      ifelse(CUXOS_pre > 10 & Percent_Anx_change  <= -50, "Anx Responder",
      ifelse(CUDOS_pre > 10 & Percent_Dep_Dchange <= -50, "Dep Responder",
      ifelse(CUDOS_pre > 10 & Percent_Dep_Dchange > 0 & CUXOS_pre > 10 & Percent_Anx_change > 0, "Both Worse",
      ifelse(CUXOS_pre > 10 & Percent_Anx_change > 0, "Anx Worse",
      ifelse(CUDOS_pre > 10 & Percent_Dep_Dchange > 0, "Dep Worse",
      ifelse(CUXOS_pre > 10 & CUDOS_pre > 10 & Percent_Anx_change < 0 & Percent_Anx_change > -50 & Percent_Dep_Dchange < 0 & Percent_Dep_Dchange > -50, "Both Unresponder",
      ifelse(CUDOS_pre > 10 & Percent_Dep_Dchange < 0 & Percent_Dep_Dchange > -50, "Dep Unresponders", 
      ifelse(CUXOS_pre > 10 & Percent_Anx_change < 0 & Percent_Anx_change > -50, "Anx Unresponders", "Low Baseline"
      )))))))))))

    
Mothership_post <- left_join(Mothership_post,RCI_DF, by = join_by(ID1)) |>
  mutate(
    Depression_Responder = ifelse(!is.na(class_RCI_dep), class_RCI_dep, NA),
      Depression_Responder = as.factor(recode(Depression_Responder,
         "1" = "2",
         "2" = "2",
         "3" = "1"
      )),
    Depression_Responder = as.factor(ifelse(!is.na(Depression_Responder), Depression_Responder, Dep_Responder)),
         Depression_Responder = as.factor(recode(Depression_Responder,
          "2" = "Non-Responder",
          "1" = "Responder"
      )),
    Anxiety_Responder = ifelse(!is.na(class_RCI_anx), class_RCI_anx, NA),
      Anxiety_Responder = as.factor(recode(Anxiety_Responder,
         "1" = "2",
         "2" = "2",
         "3" = "1"
      )),
    Anxiety_Responder = as.factor(ifelse(!is.na(Anxiety_Responder), Anxiety_Responder, Anx_Responder)),
         Anxiety_Responder = as.factor(recode(Anxiety_Responder,
          "2" = "Non-Responder",
          "1" = "Responder"
      )),
    RESPONDER_FIGS = as.factor(
        ifelse(Anxiety_Responder == "Responder" | Depression_Responder == "Responder", "Responder",
        ifelse(Anxiety_Responder == "Non-Responder" & Depression_Responder == "Non-Responder", "Non-Responder", NA)
        )))

# View(Mothership_joined)
```

AnxDep_PrePost
    ```{r}
#7. create new DF with Varaibles we want

AnxDep_PrePost <- data.frame(cbind(Mothership_post$ID1,
                                  Mothership_post$Disorder_treat,
                                  Mothership_post$BL_CUDOS,
                                  Mothership_post$BL_CUXOS,
                                  Mothership_post$CUDOS_pre,
                                  Mothership_post$CUDOS_post,
                                  Mothership_post$CUXOS_pre,
                                  Mothership_post$CUXOS_post,
                                  #Extra stuff?
                                  Mothership_post$Depression_Responder,
                                  Mothership_post$Anxiety_Responder,
                                  Mothership_post$RESPONDER_FIGS
                                  )) #%>%
  #filter(!is.na(Mothership_post$Disorder_treat))

colnames(AnxDep_PrePost) = c("ID1","Disorder_Type", "BL_CUDOS", "BL_CUXOS", "CUDOS_pre","CUDOS_post","CUXOS_pre","CUXOS_post","Depression_Responder",
                             "Anxiety_Responder", "RESPONDER_FIGS")

#8. Create long data frame

AnxDep_PrePost_Long <- AnxDep_PrePost %>% 
  pivot_longer(
    cols = CUDOS_pre:CUXOS_post, 
    names_to = "Test",
    values_to = "Score"
  )
AnxDep_PrePost_Long <-AnxDep_PrePost_Long %>%
  mutate(
    PrePost = ifelse(
      Test == "CUDOS_pre", "Pre",
      ifelse(Test == "CUXOS_pre" , "Pre", "Post"
    )),
    Score = as.integer(Score),
    Test = as.factor(Test),
    Test = as.factor(ifelse(Test == "CUDOS_pre",  "CUDOS",
                     ifelse(Test == "CUDOS_post", "CUDOS", "CUXOS"
                     ))))  
           
#9. Convert to data frame with means of values to be plotted
AnxDep_PrePost_mean<-AnxDep_PrePost_Long %>%
  group_by(Test,PrePost) %>%
  summarise(Score=mean(Score,na.rm=TRUE))


#table1::table1(~BL_CUXOS + BL_CUDOS + SUManx_DC + SUMdep_DC + CUDOS_post +CUXOS_post, data = Mothership_post)

```


### Dumbell Plot by Disorder
```{r}
Pre_ANX<-ANX_PrePost_mean %>%
  filter(PrePost == "Pre")

Post_ANX<-ANX_PrePost_mean %>%
  filter(PrePost == "Post")

Plot_Text<- dplyr::count(ANX_PrePost, Disorder_Type)
Plot_Text

"#aeb6bf"


ggplot(data=Pre_ANX,
       aes(x=Disorder_Type,y=Score,
           group=Disorder_Type,color=Disorder_Type))+
  geom_segment(aes(x=Disorder_Type, xend=Post_ANX$Disorder_Type, y=Score, yend=Post_ANX$Score),color = "#ad3e4f",
              size = 4, #Note that I sized the segment to fit the points
              alpha = .5) +
  geom_point( aes(x=Disorder_Type, y=Score), color= "#F90000", size=3.5) +
  geom_point( aes(x=Post_ANX$Disorder_Type, y=Post_ANX$Score), color= "#0CC541", size=3.5) +
  labs(title = "Mean Pre and Post Anxiety Scores By Disorder Type",
       subtitle = "Self Report anxiety was assessed using the CUXOS",
       caption = "Symptom severity: 0-10 (remission), 11-20 (minimal), 21-30 (mild), 31-40 (moderate), 41+ (severe)")+
  scale_y_reverse(limits = c(45,15)) +
  coord_flip() +
  theme_classic()+
  theme(#legend.position = "none",
         plot.background = element_rect(
      fill = "white",
      colour = "white"))
  
#sum(as.factor(ANX_PrePost$Disorder_Type))

  
Pre_DEP<-DEP_PrePost_mean %>%
  filter(PrePost == "Pre")

Post_DEP<-DEP_PrePost_mean %>%
  filter(PrePost == "Post")

ggplot(data=Pre_DEP,
       aes(x=Disorder_Type,y=Score,
           group=Disorder_Type,color=Disorder_Type))+
  geom_segment(aes(x=Disorder_Type, xend=Post_DEP$Disorder_Type, y=Score, yend=Post_DEP$Score),color = "#4068a8",
              size = 4, #Note that I sized the segment to fit the points
              alpha = .5) +
  geom_point( aes(x=Disorder_Type, y=Score), color= "#F90000", size=3.5) +
  geom_point( aes(x=Post_DEP$Disorder_Type, y=Post_DEP$Score), color= "#0CC541", size=3.5) +
  labs(title = "Mean Pre and Post Depression Scores By Disorder Type",
       subtitle = "Self Report anxiety was assessed using the CUDOS",
       caption = "Symptom severity: 0-10 (remission), 11-20 (minimal), 21-30 (mild), 31-45 (moderate), 46+ (severe)",
       ylab = "Disorder Type")+
  scale_y_reverse(limits = c(45,15)) +
  coord_flip() +
  theme_classic()+
  
  theme(#legend.position = "none",
         plot.background = element_rect(
      fill = "white",
      colour = "white"))
```




```{r}
Mothership_post <- Mothership_post |>
  #1. Filter out scores for people not in the program / don't have dataa
  filter(!is.na(Days_complete_1)) |>
    #Having people in the program for more than 40 days means that their scores may be a lot higher, they should be filtered out as result. 
  filter(!is.na(CUXOS_pre),
         !is.na(CUXOS_post),
         CUXOS_pre > 0,
         CUXOS_post >= 0,
         !is.na(CUDOS_pre),
         !is.na(CUDOS_post),
         CUDOS_pre > 0,
         CUDOS_post> 0
         ) |>
  mutate(
    Delta_Anx_DC =  CUXOS_post - CUXOS_pre,
    Delta_Dep_DC = CUDOS_post - CUDOS_pre,
    Percent_Anx_change = (Delta_Anx_DC/CUXOS_pre)*100,
    Percent_Dep_Dchange = (Delta_Dep_DC/CUDOS_pre)*100,
    #Days_complete_W = ifelse(Days_complete_1 > 40, 40, Days_complete_1),
    Anx_Responder = as.factor(
      ifelse(CUXOS_pre < 20 & Percent_Anx_change  <= -50, "Responder",
      ifelse(CUXOS_pre < 20 & Percent_Anx_change  > -50,  "Unresponders", NA)   
      )),
    Dep_Responder = as.factor(
      ifelse(CUDOS_pre < 20 & Percent_Dep_Dchange <= -50, "Responder",
      ifelse(CUDOS_pre < 20 & Percent_Dep_Dchange > -50,   "Unresponders", NA) 
      )),
    Treatment_Responder = as.factor(
      ifelse(CUXOS_pre > 10 & CUXOS_pre > 10 & Percent_Anx_change  <= -50 & Percent_Anx_change < 0 & Percent_Dep_Dchange < 0 & Percent_Dep_Dchange <= -50, "Both_Responder", 
      ifelse(CUXOS_pre > 10 & Percent_Anx_change  <= -50, "Anx Responder",
      ifelse(CUDOS_pre > 10 & Percent_Dep_Dchange <= -50, "Dep Responder",
      ifelse(CUDOS_pre > 10 & Percent_Dep_Dchange > 0 & CUXOS_pre > 10 & Percent_Anx_change > 0, "Both Worse",
      ifelse(CUXOS_pre > 10 & Percent_Anx_change > 0, "Anx Worse",
      ifelse(CUDOS_pre > 10 & Percent_Dep_Dchange > 0, "Dep Worse",
      ifelse(CUXOS_pre > 10 & CUDOS_pre > 10 & Percent_Anx_change < 0 & Percent_Anx_change > -50 & Percent_Dep_Dchange < 0 & Percent_Dep_Dchange > -50, "Both Unresponder",
      ifelse(CUDOS_pre > 10 & Percent_Dep_Dchange < 0 & Percent_Dep_Dchange > -50, "Dep Unresponders", 
      ifelse(CUXOS_pre > 10 & Percent_Anx_change < 0 & Percent_Anx_change > -50, "Anx Unresponders", "Low Baseline"
      )))))))))))

 #CUXOS_post == !(CUXOS_post %in% c(seq(1,9,1)))

ggplot(Mothership_post, aes(x = Treatment_Responder)) +
  geom_bar() +
  coord_flip() +
  scale_x_discrete(limits =c("Low Baseline", "Both Worse", "Dep Worse", "Anx Worse","Both Unresponder","Dep Unresponders", "Anx Unresponders","Both_Responder", "Anx Responder","Dep Responder"))+
  labs(
    title = "Treatment response of Anxiety and Depression",
    subtitle = "Response = 50% reduciton in scores if BL score > 10")

ggplot(Mothership_post, aes(x = Anx_Responder)) +
  geom_bar() +
  coord_flip() +
    labs(
    title = "Treatment response of Anxiety",
    subtitle = "Response = 50% reduciton in scores if BL score > 10")

ggplot(Mothership_post, aes(x = Dep_Responder)) +
  geom_bar() +
  coord_flip() +
    labs(
    title = "Treatment response of Depression",
    subtitle = "Response = 50% reduciton in scores if BL score > 10")
```


What Doug Wants

# Results
### The overall breakdown of patients’ demographics and diagnoses. 
Table – Demographics
Table – Diagnoses
```{r}
#Demographics Table
Demo_tab_df <- Mothership_Diag_treat |>
  filter(!is.na(Education_1),
         !is.na(Race_1),
         !is.na(Gender_1),
         !is.na(Disorder_Type),
         !is.na(Relationship_1)
        )

#Demographic tab
Demo_tab<-data.frame(table1::table1(~Age_1+Race_1+Education_1+Gender_1+Relationship_1, data=Demo_tab_df))
colnames(Demo_tab) <- c("Demographic","Total Sample")
view(Demo_tab)


#Disorder Table - duratin
Dis_tab <- data.frame(table1::table1(~Disorder_Type | Duration, data = Mothership_Diag_treat))
colnames(Dis_tab) <- c("Primary Diagnosis","1-5 Days", "6-10 Days", "11-15 Days","16+ Days", "Total Sample")
Dis_tab

#Disorder Tab by 10 days
Dis_tab_10 <- data.frame(table1::table1(~Disorder_Type | Duration_10, data = Mothership_Diag_treat))
colnames(Dis_tab_10) <- c("Primary Diagnosis","1-10 Days", "10+ Days", "Total Sample")
Dis_tab_10

```

###	The trajectories of depression and anxiety for all patients (both numerical – pre/post scores, overall slope, and visual – graphs). Numerical results are in text, visual results presented to supplement.

Dumbell Plot by Disorder
```{r}
AnxDep_PrePost <- data.frame(cbind(Mothership_post$ID1,
                                  Mothership_post$Disorder_Type,
                                  Mothership_post$pre_anx,
                                  Mothership_post$post_anx,
                                  Mothership_post$pre_dep,
                                  Mothership_post$post_dep)) 
  # filter(!is.na(Mothership_post$Disorder_Type))
colnames(AnxDep_PrePost) = c("ID1","Disorder_Type", "CUDOS_pre","CUDOS_post","CUXOS_pre","CUXOS_post")

Pre_ANX<-ANX_PrePost_mean %>%
  filter(PrePost == "Pre")

Post_ANX<-ANX_PrePost_mean %>%
  filter(PrePost == "Post")

Plot_Text<- dplyr::count(ANX_PrePost, Disorder_Type)
Plot_Text

"#aeb6bf"


ggplot(data=Pre_ANX,
       aes(x=Disorder_Type,y=Score,
           group=Disorder_Type,color=Disorder_Type))+
  geom_segment(aes(x=Disorder_Type, xend=Post_ANX$Disorder_Type, y=Score, yend=Post_ANX$Score),color = "#ad3e4f",
              size = 4, #Note that I sized the segment to fit the points
              alpha = .5) +
  geom_point( aes(x=Disorder_Type, y=Score), color= "#F90000", size=3.5) +
  geom_point( aes(x=Post_ANX$Disorder_Type, y=Post_ANX$Score), color= "#0CC541", size=3.5) +
  labs(title = "Mean Pre and Post Anxiety Scores By Disorder Type",
       subtitle = "Self Report anxiety was assessed using the CUXOS",
       caption = "Symptom severity: 0-10 (remission), 11-20 (minimal), 21-30 (mild), 31-40 (moderate), 41+ (severe)")+
  scale_y_reverse(limits = c(45,15)) +
  coord_flip() +
  theme_classic()+
  facet_wrap(~RESPONDER_FIGS,labeller = labeller(RESPONDER_FIGS =
      c("1" = "Non-Responders", 
        "2" = "Responders")
  ))
  theme(#legend.position = "none",
         plot.background = element_rect(
      fill = "white",
      colour = "white"))
  
#sum(as.factor(ANX_PrePost$Disorder_Type))

  
Pre_DEP<-DEP_PrePost_mean %>%
  filter(PrePost == "Pre")

Post_DEP<-DEP_PrePost_mean %>%
  filter(PrePost == "Post")

ggplot(data=Pre_DEP,
       aes(x=Disorder_Type,y=Score,
           group=Disorder_Type,color=Disorder_Type))+
  geom_segment(aes(x=Disorder_Type, xend=Post_DEP$Disorder_Type, y=Score, yend=Post_DEP$Score),color = "#4068a8",
              size = 4, #Note that I sized the segment to fit the points
              alpha = .5) +
  geom_point( aes(x=Disorder_Type, y=Score), color= "#F90000", size=3.5) +
  geom_point( aes(x=Post_DEP$Disorder_Type, y=Post_DEP$Score), color= "#0CC541", size=3.5) +
  labs(title = "Mean Pre and Post Depression Scores By Disorder Type",
       subtitle = "Self Report anxiety was assessed using the CUDOS",
       caption = "Symptom severity: 0-10 (remission), 11-20 (minimal), 21-30 (mild), 31-45 (moderate), 46+ (severe)",
       ylab = "Disorder Type")+
  scale_y_reverse(limits = c(45,15)) +
  coord_flip() +
  theme_classic()+
  theme(#legend.position = "none",
         plot.background = element_rect(
      fill = "white",
      colour = "white"))
```

### Overall Plot
```{r}
# Pre Post CUDOS/CUXOS Plot
ggplot(data=AnxDep_PrePost_mean,
       aes(x=factor(PrePost,level=c("Pre","Post")),y=Score,
           group=Test,color=fct_rev(Test)))+
  geom_point(size=2.5)+
  geom_line(group=AnxDep_PrePost_mean$PrePost,size=1.5)+
  scale_x_discrete(name="Time Point")+
  scale_y_continuous(name="CUDOS/CUXOS Score")+
  ggtitle("Mean Pre and Post Scores of the Anxiety and Depression")+
  theme(panel.grid.major.y = element_line(color = "grey",size = 0.5,linetype = 2))+
  theme(panel.background=NULL)+
  theme(legend.title = element_blank())

AnxDep_response_mean<-AnxDep_PrePost_Long %>%
  filter(!is.na(RESPONDER_FIGS)) |>
  group_by(Test,RESPONDER_FIGS,PrePost) %>%
  summarise(Score=mean(Score,na.rm=TRUE))

ggplot(data=AnxDep_response_mean,
       aes(x=factor(PrePost,level=c("Pre","Post")),y=Score,
           group=Test,color=fct_rev(Test)))+
  geom_point(size=2.5) +
  geom_line(group=AnxDep_response_mean$PrePost,size=1.5)+
  scale_x_discrete(name="Time Point")+
  scale_y_continuous(name="CUDOS/CUXOS Score")+
  ggtitle("Mean Pre and Post Scores of the Anxiety and Depression")+
  theme(panel.grid.major.y = element_line(color = "grey",size = 0.5,linetype = 2))+
  theme(panel.background=NULL)+
  theme(legend.title = element_blank()) +
  facet_wrap(~RESPONDER_FIGS,labeller = labeller(RESPONDER_FIGS =
      c("1" = "Non-Responders", 
        "2" = "Responders")
      ))
```

### Line Plot By Disorder
```{r}
#1. Creaate new datasets with only anxiety / depresssion

ANX_PrePost<- AnxDep_PrePost_Long %>%
  filter(Test == "CUXOS")

DEP_PrePost<- AnxDep_PrePost_Long %>%
  filter(Test == "CUDOS")


#2. Create DF grouped buy disorder type
ANX_PrePost_mean<-ANX_PrePost %>%
  group_by(Disorder_Type,PrePost) %>%
  summarise(Score=mean(Score,na.rm=TRUE))

DEP_PrePost_mean<-DEP_PrePost %>%
  group_by(Disorder_Type,PrePost) %>%
  summarise(Score=mean(Score,na.rm=TRUE))

#### ANX
ggplot(data=ANX_PrePost_mean,
       aes(x=factor(PrePost,level=c("Pre","Post")),y=Score,
           group=Disorder_Type,color=Disorder_Type))+
  geom_point(size=2.5)+
  geom_line(size=1)+
  scale_x_discrete(name="Time Point")+
  scale_y_continuous(name="CUXOS Score")+
  labs(title = "Mean Pre and Post Anxiety Scores By Disorder Type",
       subtitle = "Self Report anxiety was assessed using the CUXOS",
       caption = "Symptom severity: 0-10 (remission), 11-20 (minimal), 21-30 (mild), 31-40 (moderate), 41+ (severe)")+
  theme(panel.grid.major.y = element_line(color = "grey",size = 0.5,linetype = 2))+
  theme(panel.background=NULL)+
  theme(legend.title = element_blank()) 

#### DEP
ggplot(data=DEP_PrePost_mean,
       aes(x=factor(PrePost,level=c("Pre","Post")),y=Score,
           group=as.factor(Disorder_Type),color=as.factor(Disorder_Type)))+
  geom_point(size=2.5)+
  geom_line(size=1)+
  scale_x_discrete(name="Time Point")+
  scale_y_continuous(name="CUDOS Score")+
  labs(title = "Mean Pre and Post Depression Scores By Disorder Type",
       subtitle = "Self report depression was assessed using the CUDOS",
       caption = "Symptom severity: 0-10 (remission), 11-20 (minimal), 21-30 (mild), 31-45 (moderate), 46+ (severe)")+
  theme(panel.grid.major.y = element_line(color = "grey",size = 0.5,linetype = 2))+
  theme(panel.background=NULL)+
  theme(legend.title = element_blank())


### FACAT WRAP

AnxDep_Treat_mean<-AnxDep_PrePost_Long %>%
  filter(!is.na(RESPONDER_FIGS),
         !is.na(Disorder_Type)) |>
  group_by(Test,Disorder_Type,RESPONDER_FIGS,PrePost) %>%
  summarise(Score=mean(Score,na.rm=TRUE))


p <- ggplot(data=AnxDep_Treat_mean,
       aes(x=factor(PrePost,level=c("Pre","Post")),y=Score,
           group=Test,color=fct_rev(Test)))+
  geom_point(size=2.5) +
  geom_line(group=AnxDep_Treat_mean$PrePost,size=1.5)+
  scale_x_discrete(name="Time Point")+
  scale_y_continuous(name="CUDOS/CUXOS Score")+
  labs(
    title = "Mean Pre and Post Scores of the Anxiety and Depression",
    subtitle = "Treatment response based upon Disorder")+
  theme(panel.grid.major.y = element_line(color = "grey",size = 0.5,linetype = 2))+
  theme(panel.background=NULL)+
  theme(legend.title = element_blank()) +
  facet_grid(RESPONDER_FIGS~Disorder_Type,
             labeller = labeller(
               RESPONDER_FIGS = c("1" = "Non-responders", "2" = "Responders"),
               Disorder_Type = c("1" = "Anxiety", "2" = "BPD", "3" = "Mood", "4" ="Other", "5" = "Trauma")
      ))
p 
#Anxiety     BPD    Mood   Other  Trauma
```


- Broken down by treatment duration, treatment track, most common primary diagnoses.
###	The pre-post scores (numerical and visual) for RDQ subscales.
###	Reasons for discharge (numerical and visual).

# Visualizations

### Visualization – most common diagnoses.
```{r}
#frequency

ggplot(data = subset(Mothership_Diag, !is.na(Disorder_Type)),mapping =  aes(x = fct_rev(fct_infreq(Disorder_Type))))+
  geom_bar(fill = c("#EBC500", "#ffa600", "#ff7c43", "#f95d6a", "#d45087","#a05195","#665191","#2f4b7c","#003f5c"
                               ))+
  ggtitle("Frequency of Psychiatric Disorder Subtypes") +
  theme(axis.text.x = element_text(angle = 45,hjust = 1),
        legend.position = "none")+
  xlab("Psychiatric Disorder Subtype")+
  #scale_fill_manual(values = c("#003f5c","#2f4b7c","#665191", "#a05195", "#d45087", "#f95d6a", "#ff7c43", "#ffa600", "#EBC500")) +
  theme(panel.grid.major.x = element_line(color = "grey",size = 0.5,linetype = 2))+
  theme(panel.background=NULL)+
  scale_y_continuous(name = "Frequency",limits=c(0,4300))+
  coord_flip()


ggplot(data = subset(Mothership_Diag, !is.na(Disorder_Type)),mapping =  aes(x = fct_rev(fct_infreq(Disorder_Type)),fill= Disorder_Type))+
  geom_bar()+
  ggtitle("Frequency of Psychiatric Disorder Subtypes") +
  theme(axis.text.x = element_text(angle = 45,hjust = 1),
        legend.position = "none")+
  xlab("Psychiatric Disorder Subtype")+
  theme(panel.grid.major.x = element_line(color = "grey",size = 0.5,linetype = 2))+
  theme(panel.background=NULL)+
  scale_y_continuous(name = "Frequency",limits=c(0,1750))+
  scale_fill_manual(values = c("#EBC500", "#ffa600", "#ff7c43", "#f95d6a", "#d45087","#a05195","#665191","#2f4b7c","#003f5c"
                               )) +
  coord_flip()+
  facet_wrap(~Duration,labeller = labeller(Duration =
      c("1" = "1-5 Days", 
        "2" = "6-10 Days", 
        "3" = "11-15 Days",
        "4" = "16+ Days")
      ))
```

# Most co-ocurring diagnoses
```{r}
# Visualization of percent

Mothership_current_Imp <- Mothership_Diag_treat %>%
  pivot_longer(
    cols=c("Co_Anx","Co_Mood","Co_OCD","Co_BPD","Co_Psychotic","Co_Eating","Co_Somatic", "Co_Substance","Co_Trauma", "No_Co"),
    names_to = 'Disorder_Present') %>%
  filter(value != 0) %>%
  select(!value)  %>%
  filter(!is.na(Disorder_Present))%>%
  filter(!is.na(Disorder_treat)) 


co_dis_tab <- Mothership_Diag_treat |>
  pivot_longer(
    cols = c("Co_Anx","Co_Mood","Co_OCD","Co_BPD","Co_Psychotic","Co_Eating","Co_Somatic", "Co_Substance","Co_Trauma", "No_Co"),
    names_to = 'Co Occuring',
    values_to = "Number"
  ) |>
  select(Disorder_treat, `Co Occuring`, Number) |>
  filter(Number != 0,
         !is.na(`Co Occuring`),
         !is.na(Disorder_treat)) 

tabs<-as.data.frame.matrix(xtabs(~ Disorder_Present + Disorder_treat, data = Mothership_current_Imp))

anx<-summary(Mothership_Diag_treat$Anxiety_D)[2]
bpd<-summary(Mothership_Diag_treat$BPD_P)[2]
mood<-summary(Mothership_Diag_treat$Mood_D)[2]
trauma<-summary(Mothership_Diag_treat$Trauma_D)[2]
other<-summary(Mothership_Diag_treat$Other)[2]

tabs[,1] <- (tabs[,1] / anx)*100
tabs[,2] <- (tabs[,2] /bpd)*100
tabs[,3] <- (tabs[,3] /mood)*100
tabs[,4] <- (tabs[,4] /other)*100
tabs[,5] <- (tabs[,5] /trauma)*100
tabs[,6] <- c("Anxiety","BPD","Eating","Mood","OCD","Psychotic","Somatic", "Substance","Trauma", "None")
colnames(tabs)[6] = "Disorder"
tabs

CODis_tab<-data.frame(table1::table1(~`Co Occuring` | Disorder_treat, data = co_dis_tab))
CODis_tab

p <- Mothership_current_Imp %>%
  ggplot(aes(x = Disorder_treat, y = Disorder_Present, color = Disorder_treat)) +
  geom_count(aes(size = after_stat(prop),group = Disorder_treat), alpha = .75)+
 scale_size_area(max_size = 30)+
  scale_colour_manual(values = c("#ffa600","#ff6361","#bc5090","#58508d","#003f5c"))+
  #scale_size_continuous(range = c(10, 30)) +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 45,hjust = 1),
    legend.position = "none") +
  scale_y_discrete(labels=c("Other_Co" = "Other",
                            "No_Co" = "None",
                            "BPD_Co_C" = "BPD",
                            "Trauma_C" = "Trauma", 
                            "Substance_C" = "Substance Use",
                            "Mood_C" = "Mood",
                            "Anxiety_C" = "Anxiety")) +
  labs(title = "Percent of Co Occuring Psychiatric Diosrders per Primary Diagnosis",
    subtitle = "Grouped into subtypes of DSM diagonsis",
    y = "Co-Occuring Psychiatric Disorder",
    x = "Primary Psychiatric Diagnosis")

p
```


•	Visualizations – CUDOS and CUXOS trajectories by treatment duration, treatment track, most common diagnoses. 

### plot means based upon duration group membership 

```{r}
Mothership_Long_anx <- gather(Mothership_post,rm,CUXOS,Day1_CUXOS:Day40_CUXOS,factor_key = "T")
Mothership_Long_anx <- Mothership_Long_anx[order(Mothership_Long_anx$ID1),]

#Create a Time Variable
Mothership_Long_anx$TxDay <- NA
Mothership_Long_anx$TxDay[Mothership_Long_anx$rm=="Day1_CUXOS"]<-1
Mothership_Long_anx$TxDay[Mothership_Long_anx$rm=="Day2_CUXOS"]<-2
Mothership_Long_anx$TxDay[Mothership_Long_anx$rm=="Day3_CUXOS"]<-3
Mothership_Long_anx$TxDay[Mothership_Long_anx$rm=="Day4_CUXOS"]<-4
Mothership_Long_anx$TxDay[Mothership_Long_anx$rm=="Day5_CUXOS"]<-5
Mothership_Long_anx$TxDay[Mothership_Long_anx$rm=="Day6_CUXOS"]<-6
Mothership_Long_anx$TxDay[Mothership_Long_anx$rm=="Day7_CUXOS"]<-7
Mothership_Long_anx$TxDay[Mothership_Long_anx$rm=="Day8_CUXOS"]<-8
Mothership_Long_anx$TxDay[Mothership_Long_anx$rm=="Day9_CUXOS"]<-9
Mothership_Long_anx$TxDay[Mothership_Long_anx$rm=="Day10_CUXOS"]<-10
Mothership_Long_anx$TxDay[Mothership_Long_anx$rm=="Day11_CUXOS"]<-11
Mothership_Long_anx$TxDay[Mothership_Long_anx$rm=="Day12_CUXOS"]<-12
Mothership_Long_anx$TxDay[Mothership_Long_anx$rm=="Day13_CUXOS"]<-13
Mothership_Long_anx$TxDay[Mothership_Long_anx$rm=="Day14_CUXOS"]<-14
Mothership_Long_anx$TxDay[Mothership_Long_anx$rm=="Day15_CUXOS"]<-15
Mothership_Long_anx$TxDay[Mothership_Long_anx$rm=="Day16_CUXOS"]<-16
Mothership_Long_anx$TxDay[Mothership_Long_anx$rm=="Day17_CUXOS"]<-17
Mothership_Long_anx$TxDay[Mothership_Long_anx$rm=="Day18_CUXOS"]<-18
Mothership_Long_anx$TxDay[Mothership_Long_anx$rm=="Day19_CUXOS"]<-19
Mothership_Long_anx$TxDay[Mothership_Long_anx$rm=="Day20_CUXOS"]<-20

# #Create a New Data Set with an Average Anxiety Variable
# Mothership_Mean_CUXOS<-Mothership_Long_anx %>%
#   group_by(TxDay) %>%
#   summarise(mean_CUXOS=mean(CUXOS,na.rm=TRUE))

#plot Anxiety mean with each group


# New dataset for the treatment duration Anxiety plot
Mothership_Mean_CUXOS<-Mothership_Long_anx %>%
  group_by(Duration,TxDay) %>%
  summarise(mean_CUXOS=mean(CUXOS,na.rm=TRUE))

Mothership_Mean_CUXOS2 <- Mothership_Long_anx %>%
  group_by(Duration,RESPONDER_FIGS,TxDay) %>%
  summarise(Score=mean(CUXOS,na.rm=TRUE))

View(Mothership_Mean_CUXOS2)

Mothership_duration_CUXOS<-Mothership_Mean_CUXOS[1:83,]
#delete weird Na values and put NA for values
Mothership_duration_CUXOS[6:20,3] = NA
Mothership_duration_CUXOS[37:41,3] = NA
Mothership_duration_CUXOS[74:83,3] = NA
Mothership_duration_CUXOS<-Mothership_duration_CUXOS[(-21),]
Mothership_duration_CUXOS<-Mothership_duration_CUXOS[(-41),]
Mothership_duration_CUXOS<-Mothership_duration_CUXOS[(-61),]
Mothership_duration_CUXOS

ggplot(data=Mothership_duration_CUXOS,aes(x=TxDay,y=mean_CUXOS,group=Duration,color=Duration))+
  geom_line(size=1)+
  geom_point()+
  theme(panel.grid.major.y = element_line(color = "grey",size = 0.5,linetype = 2))+
  ggtitle("Mean Anxiety Severity During Partial Hospitalization")+
  scale_x_discrete(name="Treatment Day",limits=c(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20))+
  scale_y_continuous(name="Anxiety Severity",limits=c(5,50,by=5))+
  scale_color_manual(values=c("#BB9D00","red",
                              "darkred","orange"))+
  theme(panel.background=NULL)+
  labs(subtitle = "Broken up by Duration of Treatment")
```


```{r}
Mothership_Long_dep <- gather(Mothership,rm,CUDOS,Day1_CUDOS:Day40_CUDOS,factor_key = "T")
Mothership_Long_dep <- Mothership_Long_dep[order(Mothership_Long_dep$ID1),]


Mothership_Long_dep
#Create a Time Variable
Mothership_Long_dep$TxDay <- NA
Mothership_Long_dep$TxDay[Mothership_Long_dep$rm=="Day1_CUDOS"]<-1
Mothership_Long_dep$TxDay[Mothership_Long_dep$rm=="Day2_CUDOS"]<-2
Mothership_Long_dep$TxDay[Mothership_Long_dep$rm=="Day3_CUDOS"]<-3
Mothership_Long_dep$TxDay[Mothership_Long_dep$rm=="Day4_CUDOS"]<-4
Mothership_Long_dep$TxDay[Mothership_Long_dep$rm=="Day5_CUDOS"]<-5
Mothership_Long_dep$TxDay[Mothership_Long_dep$rm=="Day6_CUDOS"]<-6
Mothership_Long_dep$TxDay[Mothership_Long_dep$rm=="Day7_CUDOS"]<-7
Mothership_Long_dep$TxDay[Mothership_Long_dep$rm=="Day8_CUDOS"]<-8
Mothership_Long_dep$TxDay[Mothership_Long_dep$rm=="Day9_CUDOS"]<-9
Mothership_Long_dep$TxDay[Mothership_Long_dep$rm=="Day10_CUDOS"]<-10
Mothership_Long_dep$TxDay[Mothership_Long_dep$rm=="Day11_CUDOS"]<-11
Mothership_Long_dep$TxDay[Mothership_Long_dep$rm=="Day12_CUDOS"]<-12
Mothership_Long_dep$TxDay[Mothership_Long_dep$rm=="Day13_CUDOS"]<-13
Mothership_Long_dep$TxDay[Mothership_Long_dep$rm=="Day14_CUDOS"]<-14
Mothership_Long_dep$TxDay[Mothership_Long_dep$rm=="Day15_CUDOS"]<-15
Mothership_Long_dep$TxDay[Mothership_Long_dep$rm=="Day16_CUDOS"]<-16
Mothership_Long_dep$TxDay[Mothership_Long_dep$rm=="Day17_CUDOS"]<-17
Mothership_Long_dep$TxDay[Mothership_Long_dep$rm=="Day18_CUDOS"]<-18
Mothership_Long_dep$TxDay[Mothership_Long_dep$rm=="Day19_CUDOS"]<-19
Mothership_Long_dep$TxDay[Mothership_Long_dep$rm=="Day20_CUDOS"]<-20

# #Create a New Data Set with an Average Anxiety Variable
# Mothership_Mean_CUDOS<-Mothership_Long_dep %>%
#   group_by(TxDay) %>%
#   summarise(mean_CUDOS=mean(CUDOS,na.rm=TRUE))

#plot depression mean with each group

# New dataset for the treatment duration depression plot
Mothership_Mean_CUDOS<-Mothership_Long_dep %>%
  group_by(Duration,TxDay) %>%
  summarise(mean_CUDOS=mean(CUDOS,na.rm=TRUE))

Mothership_duration_CUDOS<-Mothership_Mean_CUDOS[1:83,]
#delete weird Na values and put NA for values
Mothership_duration_CUDOS[6:20,3] = NA
Mothership_duration_CUDOS[37:41,3] = NA
Mothership_duration_CUDOS[74:83,3] = NA
Mothership_duration_CUDOS<-Mothership_duration_CUDOS[(-21),]
Mothership_duration_CUDOS<-Mothership_duration_CUDOS[(-41),]
Mothership_duration_CUDOS<-Mothership_duration_CUDOS[(-61),]
Mothership_duration_CUDOS

ggplot(data=Mothership_duration_CUDOS,aes(x=TxDay,y=mean_CUDOS,group=Duration,color=Duration))+
  geom_line(size=1)+
  geom_point()+
  theme(panel.grid.major.y = element_line(color = "grey",size = 0.5,linetype = 2))+
  ggtitle("Mean Depression Severity During Partial Hospitalization")+
  labs(subtitle = "Broken up by Discharge Date")+
  scale_x_discrete(name="Treatment Day",limits=c(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20))+
  scale_y_continuous(name="Depression Severity",limits=c(15,40,by=5))+
  scale_color_manual(values=c("skyblue","#0065A3",
                              "navy","blue"))+
  theme(panel.background=NULL)
```



•	Visualization – RDQ pre and post change.

```{r}
#Read in a New Data Set
Mothership_RDQ<- read_sav("~/Desktop/Coding/data/Mothership_DV.sav")
Mothership_RDQ<-select(Mothership,ID1:Sexuality_1,MDD_C:Day40_CUXOS)
Mothership_RDQ<-data.frame(sapply(Mothership_RDQ,FUN=as.numeric))

#Make This Data Set Long Data
library(tidyr)
Mothership_Long_RDQ <- gather(Mothership_Diag_treat,rm,RDQ,rdqPRE_coping:rdqPOST_sym,
                              factor_key = "T")
Mothership_Long_RDQ <- Mothership_Long_RDQ[order(Mothership_Long_RDQ$ID1),]


#Create a Time Variable
Mothership_Long_RDQ$PrePost <- NA
Mothership_Long_RDQ$PrePost[Mothership_Long_RDQ$rm=="rdqPRE_coping"]<-"Pre"
Mothership_Long_RDQ$PrePost[Mothership_Long_RDQ$rm=="rdqPRE_pmh"]<-"Pre"
Mothership_Long_RDQ$PrePost[Mothership_Long_RDQ$rm=="rdqPRE_func"]<-"Pre"
Mothership_Long_RDQ$PrePost[Mothership_Long_RDQ$rm=="rdqPRE_wbs"]<-"Pre"
Mothership_Long_RDQ$PrePost[Mothership_Long_RDQ$rm=="rdqPRE_sym"]<-"Pre"
Mothership_Long_RDQ$PrePost[Mothership_Long_RDQ$rm=="rdqPOST_coping"]<-"Post"
Mothership_Long_RDQ$PrePost[Mothership_Long_RDQ$rm=="rdqPOST_pmh"]<-"Post"
Mothership_Long_RDQ$PrePost[Mothership_Long_RDQ$rm=="rdqPOST_func"]<-"Post"
Mothership_Long_RDQ$PrePost[Mothership_Long_RDQ$rm=="rdqPOST_wbs"]<-"Post"
Mothership_Long_RDQ$PrePost[Mothership_Long_RDQ$rm=="rdqPOST_sym"]<-"Post"

#Create a New Data Set with an Average Depression Variable and Race
Mothership_Mean_RDQ<-Mothership_Long_RDQ %>%
  group_by(rm,PrePost) %>%
  summarise(RDQ=mean(RDQ,na.rm=TRUE))

#Add a Paired Variable to the New Data Set
Mothership_Mean_RDQ<-mutate(Mothership_Mean_RDQ,
                            paired=case_when(rm=="rdqPRE_coping"~"1",
                                             rm=="rdqPOST_coping"~"1",
                                             rm=="rdqPRE_pmh"~"2",
                                             rm=="rdqPOST_pmh"~"2",
                                             rm=="rdqPRE_func"~"3",
                                             rm=="rdqPOST_func"~"3",
                                             rm=="rdqPRE_wbs"~"4",
                                             rm=="rdqPOST_wbs"~"4",
                                             rm=="rdqPRE_sym"~"5",
                                             rm=="rdqPOST_sym"~"5"))
  

Mothership_Mean_RDQ[,1] = c("Coping","PMH","Functioning","WBS","Symptoms","Coping","PMH","Functioning","WBS","Symptoms")


wide_rdq <- Mothership_Mean_RDQ |>
  pivot_wider(
    names_from = PrePost, values_from = RDQ
  ) |>
  select(
    rm,Pre,Post
  )

#Table
wide_rdq
```


```{r}
#Pre Post RDQ Plot - combined 
ggplot(data=Mothership_Mean_RDQ,
       aes(x=factor(PrePost,level=c("Pre","Post")),y=RDQ,
           group=rm,color=paired,!is.na(PrePost)))+
  geom_point(size=2.5)+
  geom_line(group=Mothership_Mean_RDQ$paired,size=1.5)+
  scale_x_discrete(name="Time Point")+
  scale_y_continuous(name="RDQ Subscore")+
  ggtitle("Mean Pre and Post Scores of the Remission from Depression Questionnaire")+
  theme(panel.grid.major.y = element_line(color = "grey",size = 0.5,linetype = 2))+
  theme(panel.background=NULL)+
  theme(legend.title = element_blank())+
  # scale_color_manual(values=c("1"="#8956BB","2"="#4C4452","3"="#B1A8B9",
  #                              "4"="#00BCA3","5"="#008570"),
  scale_colour_manual(values = c("#ffa600","#ff6361","#bc5090","#58508d","#003f5c"),
                     labels=c("Coping Skills","Positive Mental Health",
                              "Functioning","Well-Being","Symptoms")) 

# pre post RDQ Plot - facet wrap
ggplot(data=Mothership_Mean_RDQ,
       aes(x=factor(PrePost,level=c("Pre","Post")),y=RDQ,
           group=rm,color=paired,!is.na(PrePost))) +
  geom_point(size=2.5) +
  geom_line(group=Mothership_Mean_RDQ$paired,size=1.5) +
  scale_x_discrete(name="Time Point") +
  scale_y_continuous(name="RDQ Subscore",limits = c(0, 40)) +
  ggtitle("Mean Pre and Post Scores of the Remission from Depression Questionnaire") +
  theme(panel.grid.major.y = element_line(color = "grey",size = 0.5,linetype = 2)) +
  theme(panel.background=NULL) +
  theme(legend.position="none") +
  # scale_color_manual(values=c("1"="#8956BB","2"="#4C4452","3"="#B1A8B9",
  #                              "4"="#00BCA3","5"="#008570")) +
  scale_colour_manual(values = c("#ffa600","#ff6361","#bc5090","#58508d","#003f5c"))+
  facet_wrap(~paired, labeller = labeller(paired =
    c("1" = "Coping Skills",
      "2"="Positive Mental Health",
      "3"="Functioning",
      "4"="Well-Being",
      "5"="Symptoms")))

```

•	Table or Visualization – Reasons for discharge results.

### Discharge Status
```{r}
### Bar Chart for Discharge Status ###



ggplot(data = subset(Mothership, !is.na(DC_status_1)), mapping = aes(x = fct_rev(fct_infreq(DC_status_1))))+
  geom_bar(fill = c("#EBC500", "#ffa600", "#ff7c43", "#f95d6a", "#d45087","#a05195","#665191","#2f4b7c","#003f5c"
                               ))+
  ggtitle("Frequency of Treatment Discharge Status") +
  theme(axis.text.x = element_text(angle = 45,hjust = 1))+
  xlab("Discharge Status") +
  theme(panel.grid.major.x = element_line(color = "grey",size = 0.5,linetype = 2))+
  theme(panel.background=NULL)+
  scale_y_continuous(name = "Frequency",limits=c(0,6000)) +
  coord_flip()

ggplot(data = subset(Mothership, !is.na(DC_status_1)), mapping = aes(x = fct_rev(fct_infreq(DC_status_1))))+
  geom_bar()+ #fill = c("#EBC500", "#ffa600", "#ff7c43", "#f95d6a", "#d45087","#a05195","#665191","#2f4b7c","#003f5c"))+
  ggtitle("Frequency of Treatment Discharge Status") +
  theme(axis.text.x = element_text(angle = 45,hjust = 1))+
  xlab("Discharge Status") +
  theme(panel.grid.major.x = element_line(color = "grey",size = 0.5,linetype = 2))+
  theme(panel.background=NULL)+
  scale_y_continuous(name = "Frequency",limits=c(0,2100)) +
  #scale_fill_manual(values = c("#00AFBB", "#E7B800", "#FC4E07")) +
  coord_flip() +
  facet_wrap(~Duration,labeller = labeller(Duration =
      c("1" = "1-5 Days", 
        "2" = "6-10 Days", 
        "3" = "11-15 Days",
        "4" = "16+ Days")
      ))



```




length of treatment based upon response?
```{r}

bg_col <- "#F9FBF2"
# highlight_col <- "#FFAD05"
# highlight_col <- "FF52825"
highlight_col <- "#02d46e"
outline_col <- "darkblue"
dark_col <- "#333333"

str(Mothership_post$Days_complete_1)
subset(Mothership, !is.na(Gender_1))
ggplot(
  data = subset(Mothership_post, !is.na(RESPONDER_FIGS)),
  mapping = aes(
    x = Days_complete_1,
    y = Disorder_treat,
    group = Disorder_treat)
  )+
  geom_jitter(
    size = 0.6,
    alpha = .5,
   colour = highlight_col
    )+
  geom_boxplot(
    outlier.shape = NA,
   colour = outline_col,
   fill = highlight_col,
    alpha = 0.3) +
  scale_x_continuous(
   breaks = c(0, 15, 30, 45, 60),
    limits = c(0.00, 60)
  ) +
  facet_wrap(~RESPONDER_FIGS)
             
      #        labeller = labeller(RESPONDER_FIGS =
      # c("1" = "Non-Responders", 
      #   "2" = "Responders"))

summary(Mothership_post$Days_complete_1)
  
table1(Days_complete_1, data = Mothership_post)
#####W WHY ARE DAYS COMPLETE NOT SHOWING UP???

```






# Sociodemographic Visualizations

## {.tabset}

### Education Status
```{r}
ggplot(data = subset(Mothership, !is.na(Education_1)),mapping = aes(x = Education_1))+
  geom_bar(color = "black",fill="darkred")+
  ggtitle("Frequency of Education Level") +
  theme(axis.text.x = element_text(angle = 45,hjust = 1))+
  xlab("Education Level")+
  theme(panel.grid.major.x = element_line(color = "grey",linewidth = 0.5,linetype = 2))+
  theme(panel.background=NULL)+
  scale_y_continuous(name = "Frequency",limits=c(0,3000))+
  coord_flip()
```


### Race
```{r}
ggplot(data = subset(Mothership, !is.na(Race_1)),mapping = aes(x = Race_1))+
  geom_bar(color = "black",fill="darkblue")+
  ggtitle("Frequency of Race/Ethnicity") +
  theme(axis.text.x = element_text(angle = 45,hjust = 1))+
  xlab("Race")+
  theme(panel.grid.major.y = element_line(color = "grey",size = 0.5,linetype = 2))+
  theme(panel.background=NULL)+
  scale_y_continuous(name = "Frequency",limits=c(0,6500)) +
  coord_flip()
```

### Gender
```{r}
ggplot(data = subset(Mothership, !is.na(Gender_1)),mapping = aes(x = Gender_1))+
  geom_bar(color = "black",fill="darkorange")+
  ggtitle("Frequency of Gender") +
  theme(axis.text.x = element_text(angle = 45,hjust = 1))+
  xlab("Gender")+
  theme(panel.grid.major.y = element_line(color = "grey",size = 0.5,linetype = 2))+
  theme(panel.background=NULL)+
  coord_flip()+
  scale_y_continuous(name = "Frequency",limits=c(0,6500))
```


# Pie Chart For Education Status 
We wanted to learn how to make a pie chart in R so here is one!
```{r}
#Create Table and Data Frame
Education<-table(Mothership$Education_1)
Education_df<-as.data.frame(Education)
Education_df

#Rename Columns
colnames(Education_df)[1]="Category"
colnames(Education_df)[2]="Frequency"


Education_df$Category=recode(Education_df$Category,
                             "0"="<Grade 6", 
                             "1"="Grades 7-12",
                             "2"="HS Diploma", 
                             "3"="GED",
                             "4"="Some College",
                             "5"="Associates Degree",
                             "6"="Bachelors Degree",
                             "7"="Some Grad School",
                             "8"="Grad Degree")

ggplot(data = Education_df, mapping = aes(x="", y=Frequency, fill=Category))+
  geom_bar(stat="Identity",width=1,color="white")+
  ggtitle("Education Level of Patients") +
  scale_fill_discrete(name = "Education") +
  coord_polar("y",start=0)+
  theme_void()
```


# Treatment Related Visualizations

## {.tabset}



### Treatment Track
```{r}
### Treatment Track ###

ggplot(data = subset(Mothership, !is.na(IPT_track_1)),mapping = aes(x = IPT_track_1))+
  geom_bar(color = "black",fill="skyblue")+
  ggtitle("Frequency of Treatment Type") +
  theme(axis.text.x = element_text(angle = 45,hjust = 1))+
  xlab("Treatment Type")+
  theme(panel.grid.major.x= element_line(color = "grey",size = 0.5,linetype = 2))+
  theme(panel.background=NULL)+
  scale_y_continuous(name = "Frequency",limits=c(0,4200))+
  coord_flip()
```

### Treatment Year
```{r}
### Treatment Year ###

ggplot(data = subset(Mothership, !is.na(TxYear)),mapping = aes(x = TxYear))+
  geom_bar(color = "black",fill="#9350C7")+
  ggtitle("Frequency of Patients per Year") +
  theme(axis.text.x = element_text(angle = 45,hjust = 1))+
  xlab("Treatment Year")+
  theme(panel.grid.major.x = element_line(color = "grey",size = 0.5,linetype = 2))+
  theme(panel.background=NULL)+
  scale_y_continuous(name = "Frequency",limits=c(0,1500)) +
  coord_flip()
```

### Duration of Treatment
```{r}
### Duration of Treatment ###
ggplot(data = subset(Mothership, !is.na(Duration)),mapping = aes(x = Duration))+
  geom_bar(color = "black",fill="lightgreen")+
  ggtitle("Frequency of Patients per Duration of Treatment") +
  theme(axis.text.x = element_text(angle = 45,hjust = 1))+
  xlab("Treatment Duration")+
  theme(panel.grid.major.x = element_line(color = "grey",size = 0.5,linetype = 2))+
  theme(panel.background=NULL)+
  scale_y_continuous(name = "Frequency",limits=c(0,3000))+
  coord_flip()

```



