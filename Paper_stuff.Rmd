---
title: "Paper_stuff"
output: html_document
date: "2023-09-12"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Libraries
library(tidyverse)
library(dplyr)
library(haven)
library(ggplot2)
library(tidyr)
```

# Import data

Read in the dataset. 
```{r}
Mothership <- read_sav("~/Desktop/Coding/data/PHPoutcome_clean.sav")
View(df)
```

## Rename and Recode variables 
We can change the current variables to make them easier to interpret. 
```{r}
#recode varaibles
Mothership <- mutate(Mothership, 
                     DC_status_1 = as.factor(DC_status_1),
                     DC_status_1 = recode(DC_status_1,
                                          "1"="Complete",
                                          "2"="Nearly Complete",
                                          "3"="Insurance",
                                          "4"="Nonatteneance",
                                          "5"="Inappropriate",
                                          "6"="Inpatient",
                                          "7"="Withdrew",
                                          "8"="Dissatisfaction",
                                          "9"="Other"),
                     Education_1 = as.factor(Education_1),
                     Education_1 = recode(Education_1,
                                          "1"="<Grade 12",
                                          "2"="HS Diploma",
                                          "3"="GED",
                                          "4"="Some College",
                                          "5"="Associates Degree",
                                          "6"="Bachelors Degree",
                                          "7"="Some Grad School",
                                          "8"="Grad Degree"),
                     Gender_1 = as.factor(Gender_1),
                     Gender_1 = recode(Gender_1,
                                       "0"="Female",
                                       "1"="Male",
                                       "2"="Non-Binary",
                                       "3"="Other",
                                       "4"="Unknown"),
                     Relationship_1 = as.factor(Relationship_1),
                     Relationship_1 = recode(Relationship_1,
                                             "0"="Married",
                                             "1"="Cohabitating",
                                             "2"="Widowed",
                                             "3"="Separated",
                                             "4"="Divorced",
                                             "5"="Never Married"),
                     Sexuality_1 = as.factor(Sexuality_1),
                     Sexuality_1 = recode(Sexuality_1,
                                          "1"="Straight",
                                          "2"="Gay",
                                          "3"="Bisexual",
                                          "4"="Other"),
                     IPT_track_1 = as.factor(IPT_track_1),
                     IPT_track_1 = recode(IPT_track_1,
                                          "0"="General",
                                          "1"="Trauma",
                                          "2"="Young Adult",
                                          "3"="BPD"),
                     Race_1 = as.factor(Race_1),
                     Race_1 = recode(Race_1,
                                     "0"="White",
                                     "1"="Black",
                                     "2"="Hispanic",
                                     "3"="Asian",
                                     "4"="Portugese",
                                     "5"="Other"),
                     Education_1 = as.factor(Education_1),
                     Education_1 = recode(Education_1,
                                      "0"="<Grade 6", 
                                      "1"="Grades 7-12",
                                      "2"="HS Diploma", 
                                      "3"="GED",
                                      "4"="Some College",
                                      "5"="Associates Degree",
                                      "6"="Bachelors Degree",
                                      "7"="Some Grad School",
                                      "8"="Grad Degree"),
                     DC_status_1 = as.factor(DC_status_1),
                     DC_status_1 = recode(DC_status_1,
                                      "1"="Treatment Complete",
                                      "2"="Treatment Near Complete",
                                      "3"="Insurance Stopped",
                                      "4"="Nonattendence",
                                      "5"="Inapproparite Language",
                                      "6"="Transfered To Impatient",
                                      "7"="Withdrew for External factors",
                                      "8"="Withdrew (AMA)",
                                      "9"="Other",
                                      "10"="Other"),
                    DC_status_1 = as.factor(DC_status_1),
                    DC_status_1 = recode(DC_status_1,
                                      "1" ="Inpatient",
                                      "2" ="PHP",
                                      "3" ="APS",
                                      "4" ="Psychatrist",
                                      "5" ="PCP",
                                      "6" ="Another Physican",
                                      "7" ="Therapist",
                                      "17"="Other",
                                      "11"="Other",
                                      "0" ="Other"
                    ),
                                        
#Lets make some new variables 
      #Duration of treatment
                     Duration = as.factor(
                       ifelse(Days_complete_1>0 & Days_complete_1 <=5, "1",
                       ifelse(Days_complete_1>5 & Days_complete_1 <=10, "2",
                       ifelse(Days_complete_1>10 & Days_complete_1 <=15, "3",
                       ifelse(is.na(Days_complete_1), NA, "4"
                              ))))),
                    Duration_lab = as.factor(recode(Duration,
                                      "1"="1-5",
                                      "2"="6-10",
                                      "3"="11-15",
                                      "4"="16+"
                                      )),
                    Duration_10 = as.factor(
                      ifelse(Duration == 1 | Duration == 2, "1",
                      ifelse(Duration == 3 | Duration == 4, "2", NA)
                      )))

#Extract Year From Intake Date
#Convert to Date
library("lubridate")
Mothership$Intake_1<-ymd(Mothership$Intake_1)
Mothership$TxYear<-as.numeric(format(Mothership$Intake_1,"%Y"))
Mothership<-mutate(Mothership,
                   TxYear = as.factor(TxYear),
                   TxYear = recode(TxYear,
                                   "1582"="2014"))
```


## Export as CSV
```{r}
write.csv(Mothership,"~/Desktop/Coding/data/Mothership_paper")
```

Disorder_varaibles
```{r}
Mothership<-Mothership %>%
  mutate(
          # Mood Disorders
                     Mood_D = as.factor(
                      ifelse(
                        MDD_P ==1 | Bipolar1_P == 1 | Bipolar2_P == 1 | Dysthymia_P == 1, 1, 0)),
          # Anxiety Disorders
                    Anxiety_D = as.factor(
                      ifelse(
                        GAD_P ==1 | Panic_P == 1 | PanicAgor_P == 1 | Agoraphobia_P == 1 |
                        Social_P == 1 | Specific_P == 1, 1, 0)),
          # Obsessive Compusive Disorders
                #OCD_P is for current OCD
                OCD_P = as.factor(OCD_P),
          # Personality Disorders
                #BPD_P is for current BPD
                BPD_P = as.factor(BPD_P),
          # Substance Use Disorders
                    Substance_D = as.factor(
                      ifelse(
                        Alcohol_P == 1 | Drug_P ==1, 1, 0)),
          # Trauma or stresor related disorders
                    Trauma_D = as.factor(
                      ifelse(PTSD_P == 1 | Adjustment_P ==1, 1,0)),
          # Psychotic Disorders
                    Psychotic_D = as.factor(
                      ifelse(
                        Schiz_P == 1 | Schizaff_P == 1,1,0)),
            # Eating Disorders
                    Eating_D = as.factor(
                      ifelse(
                        Anorex_P == 1 | Bulim_P == 1 | Binge_P == 1, 1,0)),
            # Somatic Disroders
                    Somatic_D = as.factor(
                      ifelse(
                        Somat_P == 1 | UndiffSoma_P == 1| Hypochondriasis_P ==1,
                        1,0)),
                    Other = as.factor(
                        ifelse(
                        Somat_P == 1 | UndiffSoma_P == 1| Hypochondriasis_P ==1 |
                        Anorex_P == 1 | Bulim_P == 1 | Binge_P == 1 | Schiz_P == 1 | 
                        Schizaff_P == 1 | Alcohol_P == 1 | Drug_P ==1 | OCD_P ==1,
                        1,0)),
                    Disorder_Type = as.factor(
                      ifelse(Anxiety_D == 1, "Anxiety",
                      ifelse(OCD_P == 1, "OCD",
                      ifelse(BPD_P == 1, "BPD",
                      ifelse(Substance_D == 1, "Substance Use",
                      ifelse(Trauma_D == 1, "Trauma",
                      ifelse(Mood_D == 1, "Mood",
                      ifelse(Psychotic_D == 1, "Psychotic", 
                      ifelse(Eating_D == 1, "Eating", 
                      ifelse(Somatic_D == 1, "Somatic", NA
                      )))))))))),
                    Disorder_treat = as.factor(
                      ifelse(Anxiety_D == 1, "Anxiety",
                      ifelse(BPD_P == 1, "BPD",
                      ifelse(Trauma_D == 1, "Trauma",
                      ifelse(Mood_D == 1, "Mood",
                      ifelse(OCD_P == 1, "Other",
                      ifelse(Substance_D == 1, "Other",
                      ifelse(Psychotic_D == 1, "Other", 
                      ifelse(Eating_D == 1, "Other", NA
                      ))))))))),
                  Anxiety_C =  as.factor(
                    ifelse( GAD_P !=1 & GAD_C ==1 | 
                        Panic_P != 1 & Panic_C == 1 | 
                        PanicAgor_P != 1 & PanicAgor_C == 1 | 
                        Agoraphobia_P != 1 & Agoraphobia_C == 1 |
                        Social_P != 1 & Social_C == 1 | 
                        Specific_P != 1 & Specific_C == 1, 1, 0)),
                  Mood_C =  as.factor(
                    ifelse( MDD_P != 1 & MDD_C == 1 |
                        Bipolar1_P != 1 & Bipolar1_C == 1 | 
                        Bipolar2_P != 1 &  Bipolar2_C == 1 | 
                        Dysthymia_P != 1 & Dysthymia_C == 1 , 1, 0)),
                  Substance_C = as.factor(
                    ifelse(Alcohol_P != 1 & Alcohol_C == 1 | 
                        Drug_P != 1 & Drug_C ==1, 1, 0)),
                  Trauma_C = as.factor(
                    ifelse(PTSD_P != 1 & PTSD_C == 1 | 
                        Adjustment_P != 1 & Adjustment_C ==1, 1,0)),
                  Psychotic_C = as.factor(
                    ifelse(Schiz_P != 1 & Schiz_C == 1 | 
                        Schizaff_P != 1 & Schizaff_C == 1,1,0)),
                  Eating_C = as.factor(
                    ifelse(Anorex_P != 1 & Anorex_C == 1 | 
                        Bulim_P != 1 & Bulim_C == 1 | 
                        Binge_P != 1 & Binge_C == 1, 1,0)),
                  Somatic_C = as.factor(
                    ifelse(Somat_P != 1 & Somat_C == 1 | 
                        UndiffSoma_P != 1 & UndiffSoma_C == 1 | 
                        Hypochondriasis_P != 1 &  Hypochondriasis_C == 1, 1,0)),
                  OCD_Co_C = as.factor(
                    ifelse(OCD_P != 1 & OCD_C == 1,1,0)),
                  BPD_Co_C = as.factor(
                    ifelse(BPD_P != 1 & BPD_C ==1,1,0)),
                  No_Co = as.factor(
                    ifelse(BPD_Co_C == 0 &
                           OCD_Co_C == 0 &
                           Somatic_C == 0 & 
                           Eating_C == 0 &
                           Psychotic_C == 0 &
                           Trauma_C == 0 & 
                           Substance_C == 0 &
                           Mood_C == 0 &
                           Anxiety_C == 0, 1,0)),
                  Other_Co = as.factor(
                    ifelse(OCD_Co_C == 1 & 
                           Somatic_C == 1 & 
                           Eating_C == 1 &
                           Psychotic_C == 1,1,0)),
                  
          #emotional disorders
                  Emotional_dis = as.factor(
                    ifelse(Anxiety_D == 1 | OCD_P == 1 | Trauma_D == 1 |
                           Mood_D == 1, "Emotional Disorder", "Other Disorder")),
                 
          # co occuring disorders
                  Co_Anx = as.factor(
                        ifelse(Anxiety_C == 1 & Mood_D == 1 |
                                Anxiety_C == 1 & OCD_P == 1 |
                                Anxiety_C == 1 & BPD_P == 1 |
                                Anxiety_C == 1 & Substance_D == 1 |
                                Anxiety_C == 1 & Trauma_D == 1 |
                                Anxiety_C == 1 & Eating_D ==1 |
                                Anxiety_C == 1 & Psychotic_D ==1 |
                                Anxiety_C == 1 & Somatic_D ==1, 1, 0)),
                  Co_Mood = as.factor(
                        ifelse(Mood_C == 1 & Anxiety_D == 1 |
                                Mood_C == 1 & OCD_P == 1 |
                                Mood_C == 1 & BPD_P == 1 |
                                Mood_C == 1 & Substance_D == 1 |
                                Mood_C == 1 & Trauma_D == 1 |
                                Mood_C == 1 & Eating_D ==1 |
                                Mood_C == 1 & Psychotic_D ==1 |
                                Mood_C == 1 & Somatic_D==1 , 1, 0)),
                  Co_OCD = as.factor(
                        ifelse(OCD_C == 1 & Anxiety_D == 1 |
                                OCD_C == 1 & Mood_D == 1 |
                                OCD_C == 1 & BPD_P== 1 |
                                OCD_C == 1 & Substance_D == 1 |
                                OCD_C == 1 & Trauma_D == 1 |
                                OCD_C == 1 & Eating_D ==1 |
                                OCD_C == 1 & Psychotic_D ==1 |
                                OCD_C == 1 & Somatic_D ==1, 1, 0)),
                  Co_BPD = as.factor(
                        ifelse(BPD_C == 1 & Anxiety_D == 1 |
                                BPD_C == 1 & Mood_D == 1 |
                                BPD_C == 1 & OCD_P== 1 |
                                BPD_C == 1 & Substance_D == 1 |
                                BPD_C == 1 & Trauma_D == 1 |
                                BPD_C == 1 & Eating_D ==1 |
                                BPD_C == 1 & Psychotic_D ==1 |
                                BPD_C == 1 & Somatic_D ==1 , 1, 0)),
                  Co_Psychotic = as.factor(
                       ifelse(Psychotic_C == 1 & Mood_D == 1 |
                                Psychotic_C == 1 & OCD_P == 1 |
                                Psychotic_C == 1 & BPD_P == 1 |
                                Psychotic_C == 1 & Substance_D == 1 |
                                Psychotic_C == 1 & Trauma_D == 1 |
                                Psychotic_C == 1 & Eating_D ==1 |
                                Psychotic_C == 1 & Anxiety_D ==1 |
                                Psychotic_C == 1 & Somatic_D ==1, 1, 0)),
                  Co_Eating = as.factor(
                      ifelse(Eating_C == 1 & Mood_D == 1 |
                                Eating_C == 1 & OCD_P == 1 |
                                Eating_C == 1 & BPD_P == 1 |
                                Eating_C == 1 & Substance_D == 1 |
                                Eating_C == 1 & Trauma_D == 1 |
                                Eating_C == 1 & Psychotic_D ==1 |
                                Eating_C == 1 & Anxiety_D ==1 |
                                Eating_C == 1 & Somatic_D ==1, 1, 0)),
                  Co_Somatic =  as.factor(
                       ifelse(Somatic_C == 1 & Mood_D == 1 |
                                Somatic_C == 1 & OCD_P == 1 |
                                Somatic_C == 1 & BPD_P == 1 |
                                Somatic_C == 1 & Substance_D == 1 |
                                Somatic_C == 1 & Trauma_D == 1 |
                                Somatic_C == 1 & Eating_D ==1 |
                                Somatic_C == 1 & Anxiety_D ==1 |
                                Somatic_C == 1 & Substance_D ==1 |
                                Somatic_C == 1 & Psychotic_D ==1, 1, 0)),
                  Co_Substance = as.factor(
                      ifelse(Substance_C == 1 & Mood_D == 1 |
                                Substance_C == 1 & OCD_P == 1 |
                                Substance_C == 1 & BPD_P == 1 |
                                Substance_C == 1 & Substance_D == 1 |
                                Substance_C == 1 & Trauma_D == 1 |
                                Substance_C == 1 & Eating_D ==1 |
                                Substance_C == 1 & Anxiety_D ==1 |
                                Substance_C == 1 & Somatic_D ==1 |
                                Substance_C == 1 & Psychotic_D ==1, 1, 0)),
                 Co_Trauma = as.factor(
                    ifelse(Trauma_C == 1 & Mood_D == 1 |
                                Trauma_C == 1 & OCD_P == 1 |
                                Trauma_C == 1 & BPD_P == 1 |
                                Trauma_C == 1 & Substance_D == 1 |
                                Trauma_C == 1 & Eating_D ==1 |
                                Trauma_C == 1 & Anxiety_D ==1 |
                                Trauma_C == 1 & Somatic_D ==1 |
                                Trauma_C == 1 & Psychotic_D ==1, 1, 0))
  )
          
        
  



##### df for plots 

# df without NAs in date and disorder type
Mothership_Diag <- Mothership |>
  filter(!is.na(Disorder_Type)) |>
  filter(!is.na(TxYear))

Mothership_Diag_treat <- Mothership |>
  filter(!is.na(Disorder_treat),
         !is.na(TxYear),
         !is.na(Duration)) 

Main_Treat <- Mothership |>

### Export as CSV
write.csv(Mothership,"~/Desktop/Coding/data/Mothership_Diag.csv")

# df with and without depression
No_depressy <- Mothership_Diag %>%
  filter(Disorder_Type != "Mood")
```


Pre_Post
```{r}
Mothership_post <- Mothership |>
  #1. Filter out scores for people not in the program / don't have dataa
  filter(!is.na(Days_complete_1)) |>
    #Having people in the program for more than 40 days means that their scores may be a lot higher, they should be filtered out as result. 
  filter(!Days_complete_1 > 40,
         !Days_complete_1 == 0,
         !is.na(BL_CUXOS),
         !is.na(SUManx_DC),
         BL_CUXOS > 1,
         SUManx_DC > 0,
         !is.na(BL_CUDOS),
         !is.na(SUMdep_DC),
         BL_CUDOS > 1,
         SUMdep_DC > 0
         ) |>
  mutate(
    Delta_Anx_DC =  SUManx_DC - BL_CUXOS,
    Delta_Dep_DC = SUMdep_DC - BL_CUDOS,
    Percent_Anx_change = (Delta_Anx_DC/BL_CUXOS)*100,
    Percent_Dep_Dchange = (Delta_Dep_DC/BL_CUDOS)*100,
    #Days_complete_W = ifelse(Days_complete_1 > 40, 40, Days_complete_1),
    Anx_Responder = as.factor(
      ifelse(BL_CUXOS > 10 & Percent_Anx_change  <= -50, "Anx Responder",
      ifelse(BL_CUXOS > 10 & Percent_Anx_change > 0, "Anx Worse", 
      ifelse(BL_CUXOS > 10 & Percent_Anx_change < 0 & Percent_Anx_change > -50,  "Unresponders", "Low BL Anx"      
      )))),
    Dep_Responder = as.factor(
      ifelse(BL_CUDOS > 10 & Percent_Dep_Dchange <= -50, "Dep Responder",
      ifelse(BL_CUDOS > 10 & Percent_Dep_Dchange > 0, "Dep Worse", 
      ifelse(BL_CUDOS > 10 & Percent_Dep_Dchange < 0 & Percent_Dep_Dchange > -50,  "Unresponders", "Low BL Dep" 
      )))),
    Treatment_Responder = as.factor(
      ifelse(BL_CUXOS > 10 & BL_CUXOS > 10 & Percent_Anx_change  <= -50 & Percent_Anx_change < 0 & Percent_Dep_Dchange < 0 & Percent_Dep_Dchange <= -50, "Both_Responder", 
      ifelse(BL_CUXOS > 10 & Percent_Anx_change  <= -50, "Anx Responder",
      ifelse(BL_CUDOS > 10 & Percent_Dep_Dchange <= -50, "Dep Responder",
      ifelse(BL_CUDOS > 10 & Percent_Dep_Dchange > 0 & BL_CUXOS > 10 & Percent_Anx_change > 0, "Both Worse",
      ifelse(BL_CUXOS > 10 & Percent_Anx_change > 0, "Anx Worse",
      ifelse(BL_CUDOS > 10 & Percent_Dep_Dchange > 0, "Dep Worse",
      ifelse(BL_CUXOS > 10 & BL_CUDOS > 10 & Percent_Anx_change < 0 & Percent_Anx_change > -50 & Percent_Dep_Dchange < 0 & Percent_Dep_Dchange > -50, "Both Unresponder",
      ifelse(BL_CUDOS > 10 & Percent_Dep_Dchange < 0 & Percent_Dep_Dchange > -50, "Dep Unresponders", 
      ifelse(BL_CUXOS > 10 & Percent_Anx_change < 0 & Percent_Anx_change > -50, "Anx Unresponders", "Low Baseline"
      )))))))))))

summary(Mothership_post$Treatment_Responder)
summary(Mothership_post$Anx_Responder)
summary(Mothership_post$Dep_Responder)

ggplot(Mothership_post, aes(x = Treatment_Responder)) +
  geom_bar() +
  coord_flip() +
  scale_x_discrete(limits =c("Low Baseline", "Both Worse", "Dep Worse", "Anx Worse","Both Unresponder","Dep Unresponders", "Anx Unresponders","Both_Responder", "Anx Responder","Dep Responder"))+
  labs(
    title = "Treatment response of Anxiety and Depression",
    subtitle = "Response = 50% reduciton in scores if BL score > 10")

ggplot(Mothership_post, aes(x = Anx_Responder)) +
  geom_bar() +
  coord_flip() +
    labs(
    title = "Treatment response of Anxiety",
    subtitle = "Response = 50% reduciton in scores if BL score > 10")

ggplot(Mothership_post, aes(x = Dep_Responder)) +
  geom_bar() +
  coord_flip() +
    labs(
    title = "Treatment response of Depression",
    subtitle = "Response = 50% reduciton in scores if BL score > 10")

      

mean(Mothership_post$Percent_anx_change)
ggplot(Mothership_post,aes(x = Anx_Responder, y = Percent_Anx_change)) +
         geom_boxplot() +
         ylim(-50,500) + 
  scale_x_discrete(limits = c(
    ""
  ))
  
#2. Create pre_scores
      # CUXOS_pre = Day1_CUXOS,
      # CUDOS_pre = Day1_CUDOS
      # )

sum(Mothership_post$SUManx_DC < 0)


(40-50)/50
```

What Doug Wants

# Results
### The overall breakdown of patients’ demographics and diagnoses.
###	The trajectories of depression and anxiety for all patients (both numerical – pre/post scores, overall slope, and visual – graphs). Numerical results are in text, visual results presented to supplement.
- Broken down by treatment duration, treatment track, most common primary diagnoses.
###	The pre-post scores (numerical and visual) for RDQ subscales.
###	Reasons for discharge (numerical and visual).

# Visualizations
### Table – Demographics
### Table – Diagnoses
```{r}
#Demographics Table
Demo_tab_df <- Mothership_Diag_treat |>
  filter(!is.na(Education_1),
         !is.na(Race_1),
         !is.na(Gender_1),
         !is.na(Disorder_Type),
         !is.na(Relationship_1),
         
        )

#Demographic tab
Demo_tab<-data.frame(table1::table1(~Age_1+Education_1+Race_1+Gender_1+Relationship_1, data=Demo_tab_df))
colnames(Demo_tab) <- c("Variable","Total Sample")
Demo_tab

#Disorder Table - duratin
Dis_tab <- data.frame(table1::table1(~Disorder_Type | Duration, data = Mothership_Diag_treat))
colnames(Dis_tab) <- c("Primary Diagnosis","1-5 Days", "6-10 Days", "11-15 Days","16+ Days", "Total Sample")
Dis_tab

#Disorder Tab by 10 days
Dis_tab_10 <- data.frame(table1::table1(~Disorder_Type | Duration_10, data = Mothership_Diag_treat))
colnames(Dis_tab_10) <- c("Primary Diagnosis","1-10 Days", "10+ Days", "Total Sample")
Dis_tab_10

```
### Visualization – most common diagnoses.
```{r}
#frequency

ggplot(data = subset(Mothership_Diag, !is.na(Disorder_Type)),mapping =  aes(x = fct_rev(fct_infreq(Disorder_Type))))+
  geom_bar(fill = c("#EBC500", "#ffa600", "#ff7c43", "#f95d6a", "#d45087","#a05195","#665191","#2f4b7c","#003f5c"
                               ))+
  ggtitle("Frequency of Psychiatric Disorder Subtypes") +
  theme(axis.text.x = element_text(angle = 45,hjust = 1),
        legend.position = "none")+
  xlab("Psychiatric Disorder Subtype")+
  #scale_fill_manual(values = c("#003f5c","#2f4b7c","#665191", "#a05195", "#d45087", "#f95d6a", "#ff7c43", "#ffa600", "#EBC500")) +
  theme(panel.grid.major.x = element_line(color = "grey",size = 0.5,linetype = 2))+
  theme(panel.background=NULL)+
  scale_y_continuous(name = "Frequency",limits=c(0,4300))+
  coord_flip()


ggplot(data = subset(Mothership_Diag, !is.na(Disorder_Type)),mapping =  aes(x = fct_rev(fct_infreq(Disorder_Type)),fill= Disorder_Type))+
  geom_bar()+
  ggtitle("Frequency of Psychiatric Disorder Subtypes") +
  theme(axis.text.x = element_text(angle = 45,hjust = 1),
        legend.position = "none")+
  xlab("Psychiatric Disorder Subtype")+
  theme(panel.grid.major.x = element_line(color = "grey",size = 0.5,linetype = 2))+
  theme(panel.background=NULL)+
  scale_y_continuous(name = "Frequency",limits=c(0,1750))+
  scale_fill_manual(values = c("#EBC500", "#ffa600", "#ff7c43", "#f95d6a", "#d45087","#a05195","#665191","#2f4b7c","#003f5c"
                               )) +
  coord_flip()+
  facet_wrap(~Duration,labeller = labeller(Duration =
      c("1" = "1-5 Days", 
        "2" = "6-10 Days", 
        "3" = "11-15 Days",
        "4" = "16+ Days")
      ))
```

# Most co-ocurring diagnoses
```{r}
# Visualization of percent

Mothership_current_Imp <- Mothership_Diag_treat %>%
  pivot_longer(
    cols=c("Co_Anx","Co_Mood","Co_OCD","Co_BPD","Co_Psychotic","Co_Eating","Co_Somatic", "Co_Substance","Co_Trauma", "No_Co"),
    names_to = 'Disorder_Present') %>%
  filter(value != 0) %>%
  select(!value)  %>%
  filter(!is.na(Disorder_Present))%>%
  filter(!is.na(Disorder_treat)) 


co_dis_tab <- Mothership_Diag_treat |>
  pivot_longer(
    cols = c("Co_Anx","Co_Mood","Co_OCD","Co_BPD","Co_Psychotic","Co_Eating","Co_Somatic", "Co_Substance","Co_Trauma", "No_Co"),
    names_to = 'Co Occuring',
    values_to = "Number"
  ) |>
  select(Disorder_treat, `Co Occuring`, Number) |>
  filter(Number != 0,
         !is.na(`Co Occuring`),
         !is.na(Disorder_treat)) 

tabs<-as.data.frame.matrix(xtabs(~ Disorder_Present + Disorder_treat, data = Mothership_current_Imp))

anx<-summary(Mothership_Diag_treat$Anxiety_D)[2]
bpd<-summary(Mothership_Diag_treat$BPD_P)[2]
mood<-summary(Mothership_Diag_treat$Mood_D)[2]
trauma<-summary(Mothership_Diag_treat$Trauma_D)[2]
other<-summary(Mothership_Diag_treat$Other)[2]

tabs[,1] <- (tabs[,1] / anx)*100
tabs[,2] <- (tabs[,2] /bpd)*100
tabs[,3] <- (tabs[,3] /mood)*100
tabs[,4] <- (tabs[,4] /other)*100
tabs[,5] <- (tabs[,5] /trauma)*100
tabs[,6] <- c("Anxiety","BPD","Eating","Mood","OCD","Psychotic","Somatic", "Substance","Trauma", "None")
colnames(tabs)[6] = "Disorder"
tabs

CODis_tab<-data.frame(table1::table1(~`Co Occuring` | Disorder_treat, data = co_dis_tab))
CODis_tab

p <- Mothership_current_Imp %>%
  ggplot(aes(x = Disorder_treat, y = Disorder_Present, color = Disorder_treat)) +
  geom_count(aes(size = after_stat(prop),group = Disorder_treat), alpha = .75)+
 scale_size_area(max_size = 30)+
  scale_colour_manual(values = c("#ffa600","#ff6361","#bc5090","#58508d","#003f5c"))+
  #scale_size_continuous(range = c(10, 30)) +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 45,hjust = 1),
    legend.position = "none") +
  scale_y_discrete(labels=c("Other_Co" = "Other",
                            "No_Co" = "None",
                            "BPD_Co_C" = "BPD",
                            "Trauma_C" = "Trauma", 
                            "Substance_C" = "Substance Use",
                            "Mood_C" = "Mood",
                            "Anxiety_C" = "Anxiety")) +
  labs(title = "Percent of Co Occuring Psychiatric Diosrders per Primary Diagnosis",
    subtitle = "Grouped into subtypes of DSM diagonsis",
    y = "Co-Occuring Psychiatric Disorder",
    x = "Primary Psychiatric Diagnosis")

p
```


•	Visualizations – CUDOS and CUXOS trajectories by treatment duration, treatment track, most common diagnoses. 

### plot means based upon duration group membership 




•	Visualization – RDQ pre and post change.

```{r}
#Read in a New Data Set
Mothership_RDQ<- read_sav("~/Desktop/Coding/data/Mothership_DV.sav")
Mothership_RDQ<-select(Mothership,ID1:Sexuality_1,MDD_C:Day40_CUXOS)
Mothership_RDQ<-data.frame(sapply(Mothership_RDQ,FUN=as.numeric))

#Make This Data Set Long Data
library(tidyr)
Mothership_Long_RDQ <- gather(Mothership_RDQ,rm,RDQ,rdqPRE_coping:rdqPOST_sym,
                              factor_key = "T")
Mothership_Long_RDQ <- Mothership_Long_RDQ[order(Mothership_Long_RDQ$ID1),]

#Create a Time Variable
Mothership_Long_RDQ$PrePost <- NA
Mothership_Long_RDQ$PrePost[Mothership_Long_RDQ$rm=="rdqPRE_coping"]<-"Pre"
Mothership_Long_RDQ$PrePost[Mothership_Long_RDQ$rm=="rdqPRE_pmh"]<-"Pre"
Mothership_Long_RDQ$PrePost[Mothership_Long_RDQ$rm=="rdqPRE_func"]<-"Pre"
Mothership_Long_RDQ$PrePost[Mothership_Long_RDQ$rm=="rdqPRE_wbs"]<-"Pre"
Mothership_Long_RDQ$PrePost[Mothership_Long_RDQ$rm=="rdqPRE_sym"]<-"Pre"
Mothership_Long_RDQ$PrePost[Mothership_Long_RDQ$rm=="rdqPOST_coping"]<-"Post"
Mothership_Long_RDQ$PrePost[Mothership_Long_RDQ$rm=="rdqPOST_pmh"]<-"Post"
Mothership_Long_RDQ$PrePost[Mothership_Long_RDQ$rm=="rdqPOST_func"]<-"Post"
Mothership_Long_RDQ$PrePost[Mothership_Long_RDQ$rm=="rdqPOST_wbs"]<-"Post"
Mothership_Long_RDQ$PrePost[Mothership_Long_RDQ$rm=="rdqPOST_sym"]<-"Post"



#Create a New Data Set with an Average Depression Variable and Race
Mothership_Mean_RDQ<-Mothership_Long_RDQ %>%
  group_by(rm,PrePost) %>%
  summarise(RDQ=mean(RDQ,na.rm=TRUE))

#Add a Paired Variable to the New Data Set
Mothership_Mean_RDQ<-mutate(Mothership_Mean_RDQ,
                            paired=case_when(rm=="rdqPRE_coping"~"1",
                                             rm=="rdqPOST_coping"~"1",
                                             rm=="rdqPRE_pmh"~"2",
                                             rm=="rdqPOST_pmh"~"2",
                                             rm=="rdqPRE_func"~"3",
                                             rm=="rdqPOST_func"~"3",
                                             rm=="rdqPRE_wbs"~"4",
                                             rm=="rdqPOST_wbs"~"4",
                                             rm=="rdqPRE_sym"~"5",
                                             rm=="rdqPOST_sym"~"5"))


#Pre Post RDQ Plot - combined 
ggplot(data=Mothership_Mean_RDQ,
       aes(x=factor(PrePost,level=c("Pre","Post")),y=RDQ,
           group=rm,color=paired,!is.na(PrePost)))+
  geom_point(size=2.5)+
  geom_line(group=Mothership_Mean_RDQ$paired,size=1.5)+
  scale_x_discrete(name="Time Point")+
  scale_y_continuous(name="RDQ Subscore")+
  ggtitle("Mean Pre and Post Scores of the Remission from Depression Questionnaire")+
  theme(panel.grid.major.y = element_line(color = "grey",size = 0.5,linetype = 2))+
  theme(panel.background=NULL)+
  theme(legend.title = element_blank())+
  # scale_color_manual(values=c("1"="#8956BB","2"="#4C4452","3"="#B1A8B9",
  #                              "4"="#00BCA3","5"="#008570"),
  scale_colour_manual(values = c("#ffa600","#ff6361","#bc5090","#58508d","#003f5c"),
                     labels=c("Coping Skills","Positive Mental Health",
                              "Functioning","Well-Being","Symptoms")) 



# pre post RDQ Plot - facet wrap
ggplot(data=Mothership_Mean_RDQ,
       aes(x=factor(PrePost,level=c("Pre","Post")),y=RDQ,
           group=rm,color=paired,!is.na(PrePost))) +
  geom_point(size=2.5) +
  geom_line(group=Mothership_Mean_RDQ$paired,size=1.5) +
  scale_x_discrete(name="Time Point") +
  scale_y_continuous(name="RDQ Subscore",limits = c(0, 40)) +
  ggtitle("Mean Pre and Post Scores of the Remission from Depression Questionnaire") +
  theme(panel.grid.major.y = element_line(color = "grey",size = 0.5,linetype = 2)) +
  theme(panel.background=NULL) +
  theme(legend.position="none") +
  # scale_color_manual(values=c("1"="#8956BB","2"="#4C4452","3"="#B1A8B9",
  #                              "4"="#00BCA3","5"="#008570")) +
  scale_colour_manual(values = c("#ffa600","#ff6361","#bc5090","#58508d","#003f5c"))+
  facet_wrap(~paired, labeller = labeller(paired =
    c("1" = "Coping Skills",
      "2"="Positive Mental Health",
      "3"="Functioning",
      "4"="Well-Being",
      "5"="Symptoms")))

```

•	Table or Visualization – Reasons for discharge results.

### Discharge Status
```{r}
### Bar Chart for Discharge Status ###



ggplot(data = subset(Mothership, !is.na(DC_status_1)), mapping = aes(x = fct_rev(fct_infreq(DC_status_1))))+
  geom_bar(fill = c("#EBC500", "#ffa600", "#ff7c43", "#f95d6a", "#d45087","#a05195","#665191","#2f4b7c","#003f5c"
                               ))+
  ggtitle("Frequency of Treatment Discharge Status") +
  theme(axis.text.x = element_text(angle = 45,hjust = 1))+
  xlab("Discharge Status") +
  theme(panel.grid.major.x = element_line(color = "grey",size = 0.5,linetype = 2))+
  theme(panel.background=NULL)+
  scale_y_continuous(name = "Frequency",limits=c(0,6000)) +
  coord_flip()

ggplot(data = subset(Mothership, !is.na(DC_status_1)), mapping = aes(x = fct_rev(fct_infreq(DC_status_1))))+
  geom_bar()+ #fill = c("#EBC500", "#ffa600", "#ff7c43", "#f95d6a", "#d45087","#a05195","#665191","#2f4b7c","#003f5c"))+
  ggtitle("Frequency of Treatment Discharge Status") +
  theme(axis.text.x = element_text(angle = 45,hjust = 1))+
  xlab("Discharge Status") +
  theme(panel.grid.major.x = element_line(color = "grey",size = 0.5,linetype = 2))+
  theme(panel.background=NULL)+
  scale_y_continuous(name = "Frequency",limits=c(0,2100)) +
  #scale_fill_manual(values = c("#00AFBB", "#E7B800", "#FC4E07")) +
  coord_flip() +
  facet_wrap(~Duration,labeller = labeller(Duration =
      c("1" = "1-5 Days", 
        "2" = "6-10 Days", 
        "3" = "11-15 Days",
        "4" = "16+ Days")
      ))



```









# Sociodemographic Visualizations

## {.tabset}

### Education Status
```{r}
ggplot(data = subset(Mothership, !is.na(Education_1)),mapping = aes(x = Education_1))+
  geom_bar(color = "black",fill="darkred")+
  ggtitle("Frequency of Education Level") +
  theme(axis.text.x = element_text(angle = 45,hjust = 1))+
  xlab("Education Level")+
  theme(panel.grid.major.x = element_line(color = "grey",linewidth = 0.5,linetype = 2))+
  theme(panel.background=NULL)+
  scale_y_continuous(name = "Frequency",limits=c(0,3000))+
  coord_flip()
```


### Race
```{r}
ggplot(data = subset(Mothership, !is.na(Race_1)),mapping = aes(x = Race_1))+
  geom_bar(color = "black",fill="darkblue")+
  ggtitle("Frequency of Race/Ethnicity") +
  theme(axis.text.x = element_text(angle = 45,hjust = 1))+
  xlab("Race")+
  theme(panel.grid.major.y = element_line(color = "grey",size = 0.5,linetype = 2))+
  theme(panel.background=NULL)+
  scale_y_continuous(name = "Frequency",limits=c(0,6500)) +
  coord_flip()
```

### Gender
```{r}
ggplot(data = subset(Mothership, !is.na(Gender_1)),mapping = aes(x = Gender_1))+
  geom_bar(color = "black",fill="darkorange")+
  ggtitle("Frequency of Gender") +
  theme(axis.text.x = element_text(angle = 45,hjust = 1))+
  xlab("Gender")+
  theme(panel.grid.major.y = element_line(color = "grey",size = 0.5,linetype = 2))+
  theme(panel.background=NULL)+
  coord_flip()+
  scale_y_continuous(name = "Frequency",limits=c(0,6500))
```


# Pie Chart For Education Status 
We wanted to learn how to make a pie chart in R so here is one!
```{r}
#Create Table and Data Frame
Education<-table(Mothership$Education_1)
Education_df<-as.data.frame(Education)
Education_df

#Rename Columns
colnames(Education_df)[1]="Category"
colnames(Education_df)[2]="Frequency"


Education_df$Category=recode(Education_df$Category,
                             "0"="<Grade 6", 
                             "1"="Grades 7-12",
                             "2"="HS Diploma", 
                             "3"="GED",
                             "4"="Some College",
                             "5"="Associates Degree",
                             "6"="Bachelors Degree",
                             "7"="Some Grad School",
                             "8"="Grad Degree")

ggplot(data = Education_df, mapping = aes(x="", y=Frequency, fill=Category))+
  geom_bar(stat="Identity",width=1,color="white")+
  ggtitle("Education Level of Patients") +
  scale_fill_discrete(name = "Education") +
  coord_polar("y",start=0)+
  theme_void()
```


# Treatment Related Visualizations

## {.tabset}



### Treatment Track
```{r}
### Treatment Track ###

ggplot(data = subset(Mothership, !is.na(IPT_track_1)),mapping = aes(x = IPT_track_1))+
  geom_bar(color = "black",fill="skyblue")+
  ggtitle("Frequency of Treatment Type") +
  theme(axis.text.x = element_text(angle = 45,hjust = 1))+
  xlab("Treatment Type")+
  theme(panel.grid.major.x= element_line(color = "grey",size = 0.5,linetype = 2))+
  theme(panel.background=NULL)+
  scale_y_continuous(name = "Frequency",limits=c(0,4200))+
  coord_flip()
```

### Treatment Year
```{r}
### Treatment Year ###

ggplot(data = subset(Mothership, !is.na(TxYear)),mapping = aes(x = TxYear))+
  geom_bar(color = "black",fill="#9350C7")+
  ggtitle("Frequency of Patients per Year") +
  theme(axis.text.x = element_text(angle = 45,hjust = 1))+
  xlab("Treatment Year")+
  theme(panel.grid.major.x = element_line(color = "grey",size = 0.5,linetype = 2))+
  theme(panel.background=NULL)+
  scale_y_continuous(name = "Frequency",limits=c(0,1500)) +
  coord_flip()
```

### Duration of Treatment
```{r}
### Duration of Treatment ###
ggplot(data = subset(Mothership, !is.na(Duration)),mapping = aes(x = Duration))+
  geom_bar(color = "black",fill="lightgreen")+
  ggtitle("Frequency of Patients per Duration of Treatment") +
  theme(axis.text.x = element_text(angle = 45,hjust = 1))+
  xlab("Treatment Duration")+
  theme(panel.grid.major.x = element_line(color = "grey",size = 0.5,linetype = 2))+
  theme(panel.background=NULL)+
  scale_y_continuous(name = "Frequency",limits=c(0,3000))+
  coord_flip()

```



