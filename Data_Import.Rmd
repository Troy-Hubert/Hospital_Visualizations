---
title: "Data_Import"
output: html_document
date: "2023-04-01"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Libraries
library(tidyverse)
library(dplyr)
library(haven)
library(ggplot2)
library(tidyr)
```

## Import data
Read in the dataset. 
```{r}
df <- read_sav("~/Desktop/Coding/data/Mothership_DV.sav")
#view(df)
Mothership<-select(df,ID1:Sexuality_1,MDD_C:Day40_CUXOS)
```
## Rename and Recode variables 
We can change the current variables to make them easier to interpret. 
```{r}
#recode varaibles

Mothership <- mutate(Mothership, 
                     DC_status_1 = as.factor(DC_status_1),
                     DC_status_1 = recode(DC_status_1,
                                          "1"="Complete",
                                          "2"="Nearly Complete",
                                          "3"="Insurance",
                                          "4"="Nonatteneance",
                                          "5"="Inappropriate",
                                          "6"="Inpatient",
                                          "7"="Withdrew",
                                          "8"="Dissatisfaction",
                                          "9"="Other"),
                     Education_1 = as.factor(Education_1),
                     Education_1 = recode(Education_1,
                                          "1"="<Grade 12",
                                          "2"="HS Diploma",
                                          "3"="GED",
                                          "4"="Some College",
                                          "5"="Associates Degree",
                                          "6"="Bachelors Degree",
                                          "7"="Some Grad School",
                                          "8"="Grad Degree"),
                     Gender_1 = as.factor(Gender_1),
                     Gender_1 = recode(Gender_1,
                                       "0"="Female",
                                       "1"="Male",
                                       "2"="Non-Binary",
                                       "3"="Other",
                                       "4"="Unknown"),
                     Relationship_1 = as.factor(Relationship_1),
                     Relationship_1 = recode(Relationship_1,
                                             "0"="Married",
                                             "1"="Cohabitating",
                                             "2"="Widowed",
                                             "3"="Separated",
                                             "4"="Divorced",
                                             "5"="Never Married"),
                     Sexuality_1 = as.factor(Sexuality_1),
                     Sexuality_1 = recode(Sexuality_1,
                                          "1"="Straight",
                                          "2"="Gay",
                                          "3"="Bisexual",
                                          "4"="Other"),
                     IPT_track_1 = as.factor(IPT_track_1),
                     IPT_track_1 = recode(IPT_track_1,
                                          "0"="General",
                                          "1"="Trauma",
                                          "2"="Young Adult",
                                          "3"="BPD"),
                     Race_1 = as.factor(Race_1),
                     Race_1 = recode(Race_1,
                                     "0"="White",
                                     "1"="Black",
                                     "2"="Hispanic",
                                     "3"="Asian",
                                     "4"="Portugese",
                                     "5"="Other"),
                     Education_1 = as.factor(Education_1),
                     Education_1 = recode(Education_1,
                                      "0"="<Grade 6", 
                                      "1"="Grades 7-12",
                                      "2"="HS Diploma", 
                                      "3"="GED",
                                      "4"="Some College",
                                      "5"="Associates Degree",
                                      "6"="Bachelors Degree",
                                      "7"="Some Grad School",
                                      "8"="Grad Degree"),
  
#Lets make some new variables 
      #Duration of treatment
                     Duration = as.factor(
                       ifelse(Days_complete_1>0 & Days_complete_1 <=5, "1-5",
                       ifelse(Days_complete_1>5 & Days_complete_1 <=10, "6-10",
                       ifelse(Days_complete_1>10 & Days_complete_1 <=15, "11-15", "16+"
                              )))),
      #Disorder subtypes 
          # Mood Disorders
                     Mood_D = as.factor(
                      ifelse(
                        MDD_C ==1 | AnyBipolar_C == 1 | Bipolar1_C == 1 | Dysthymia_C == 1 |
                        OtherMood_C, 1, 0)),
          # Anxiety Disorders
                    Anxiety_D = as.factor(
                      ifelse(
                        GAD_C ==1 | Panic_C == 1 | PanicAgor_C == 1 | Agoraphobia_C == 1 |
                        Social_C == 1 | Specific_C == 1 | OtherAnx_C, 1, 0)),
          # Obsessive Compusive Disorders
                #OCD_C is for current OCD
          # Personality Disorders
                #BPD_C is for current BPD
          # Substance Use Disorders
                    Substance_D = as.factor(
                      ifelse(
                        Alcohol_C == 1 | Drug_C ==1, 1, 0)),
          # Trauma or stresor related disorders
                    Trauma_D = as.factor(
                      ifelse(PTSD_C == 1 | Adjustment_C ==1, 1,0)),
          # Psychotic Disorders
                    Psychotic_D = as.factor(
                      ifelse(
                        Schiz_C == 1 | Schizaff_C == 1 | AnyPsychotic_C ==1,1,0)),
            # Eating Disorders
                    Eating_D = as.factor(
                      ifelse(
                        AnyEating_C ==1 | Anorex_C == 1 | Bulim_C == 1 | Binge_C == 1, 1,0))
                    )
                    Disorder_Type = as.factor(
                      
                    )
                     
#Extract Year From Intake Date
#Convert to Date
library("lubridate")
Mothership$Intake_1<-mdy(Mothership$Intake_1,locale = "en_US.UTF-8")
Mothership$TxYear<-as.numeric(format(Mothership$Intake_1,"%Y"))

Mothership<-mutate(Mothership,
                   TxYear = as.factor(TxYear),
                   TxYear = recode(TxYear,
                                   "1582"="2014",
                                   "2021"="2020",
                                   "2022"="2020"))

```

## Export as CSV
```{r}
write.csv(Mothership,"~/Desktop/Coding/data/Mothership_Vis.csv")
```

# Background Statistics
```{r}
### Bar Chart for Discharge Status ###
plot(Mothership2$DC_status_1)

ggplot(data = subset(Mothership, !is.na(DC_status_1)), mapping = aes(x = DC_status_1))+
  geom_bar(color = "black",fill="darkgreen")+
  ggtitle("Frequency of Treatment Discharge Status") +
  theme(axis.text.x = element_text(angle = 45,hjust = 1))+
  xlab("Discharge Status") +
  theme(panel.grid.major.y = element_line(color = "grey",size = 0.5,linetype = 2))+
  theme(panel.background=NULL)+
  scale_y_continuous(name = "Frequency",limits=c(0,6000))

### Bar Chart for Education Status ###

ggplot(data = subset(Mothership, !is.na(Education_1)),mapping = aes(x = Education_1))+
  geom_bar(color = "black",fill="darkred")+
  ggtitle("Frequency of Education Level") +
  theme(axis.text.x = element_text(angle = 45,hjust = 1))+
  xlab("Education Level")+
  theme(panel.grid.major.y = element_line(color = "grey",size = 0.5,linetype = 2))+
  theme(panel.background=NULL)+
  scale_y_continuous(name = "Frequency",limits=c(0,3000))
```

## Pie Chart For Education Status 
```{r}
#Create Table and Data Frame
Education<-table(Mothership$Education_1)
Education_df<-as.data.frame(Education)
Education_df

#Rename Columns
colnames(Education_df)[1]="Category"
colnames(Education_df)[2]="Frequency"


Education_df$Category=recode(Education_df$Category,
                             "0"="<Grade 6", 
                             "1"="Grades 7-12",
                             "2"="HS Diploma", 
                             "3"="GED",
                             "4"="Some College",
                             "5"="Associates Degree",
                             "6"="Bachelors Degree",
                             "7"="Some Grad School",
                             "8"="Grad Degree")

ggplot(data = Education_df, mapping = aes(x="", y=Frequency, fill=Category))+
  geom_bar(stat="Identity",width=1,color="white")+
  coord_polar("y",start=0)+
  theme_void()
```

#### Amount of disorders treated
```{r}

```

